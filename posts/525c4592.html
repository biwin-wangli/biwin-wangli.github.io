
<!DOCTYPE html>
<html lang="zh-cn">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="BiWin&#39;s Blog">
    <title>五、(Docker系列)Docker深度提升篇笔记 - BiWin&#39;s Blog</title>
    <meta name="author" content="Mr.WangLi">
    
        <meta name="keywords" content="Hexo,javascript,java,docker,kubernetes,jvm,mysql,nodejs,vue,mybatis,Docker,Docker Compose,Docker Swarm">
    
    
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Mr.WangLi","sameAs":["https://github.com/biwin-wangli","http://stackoverflow.com/users","https://www.linkedin.com/profile/","mailto:274027703@qq.com"],"image":"https://img.biwin.eu.org/touxiang.jpeg"},"articleBody":"\n\n\nDocker Compose\n官网：https://docs.docker.com/compose/\n\n6.1 业务背景6.2 Docker传统方式实现6.2.1 写Python代码&amp;build image\n(1)创建文件夹\n\n12mkdir -p /tmp/composetestcd /tmp/composetest\n\n\n(2)创建app.py文件，写业务内容\n\n1234567891011121314151617181920212223import timeimport redisfrom flask import Flaskapp = Flask(__name__)cache = redis.Redis(host=&#x27;redis&#x27;, port=6379)def get_hit_count():    retries = 5    while True:        try:            return cache.incr(&#x27;hits&#x27;)        except redis.exceptions.ConnectionError as exc:            if retries == 0:                raise exc            retries -= 1            time.sleep(0.5)@app.route(&#x27;/&#x27;)def hello():    count = get_hit_count()    return &#x27;Hello World! I have been seen &#123;&#125; times.\\n&#x27;.format(count)\n\n\n(3)新建requirements.txt文件\n\n12flaskredis\n\n\n(4)编写Dockerfile\n\n123456789FROM python:3.7-alpineWORKDIR /codeENV FLASK_APP app.pyENV FLASK_RUN_HOST 0.0.0.0RUN apk add --no-cache gcc musl-dev linux-headersCOPY requirements.txt requirements.txtRUN pip install -r requirements.txtCOPY . .CMD [&quot;flask&quot;, &quot;run&quot;]\n\n\n(5)根据Dockerfile生成image\n\n1docker build -t python-app-image .\n\n\n(6)查看images：docker images\n\n1python-app-image latest 7e1d81f366b7 3 minutes ago  213MB\n\n6.2.2 获取Redis的image1docker pull redis:alpine\n\n6.2.3 创建两个container\n(1)创建网络\n\n12docker network lsdocker network create --subnet=172.20.0.0/24 app-net \n\n\n(1)创建python程序的container，并指定网段和端口\n\n1docker run -d --name web -p 5000:5000 --network app-net python-app-image\n\n\n(2)创建redis的container，并指定网段\n\n1docker run -d --name redis --network app-net redis:alpine\n\n6.2.4 访问测试ip[centos]:5000\n6.3 简介和安装6.3.1 简介\n官网：https://docs.docker.com/compose/\n1Compose is a tool for defining and running multi-container Docker applications. With Compose, you use a YAML file to configure your application’s services. Then, with a single command, you create and start all the services from your configuration.\n\n6.3.2 安装\nLinux环境中需要单独安装\n官网：https://docs.docker.com/compose/install/\n\n1sudo curl -L &quot;https://github.com/docker/compose/releases/download/1.24.1/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose\n\n1sudo chmod +x /usr/local/bin/docker-compose\n\n6.4 docker compose实现\nreference：https://docs.docker.com/compose/gettingstarted/\n\n6.4.1 同样的前期准备新建目录，比如composetest\n进入目录，编写app.py代码\n创建requirements.txt文件\n编写Dockerfile\n6.4.2 编写docker-compose.yaml文件默认名称，当然也可以指定，docker-compose.yaml\n1234567891011121314151617version: &#x27;3&#x27;services:  web:    build: .    ports:      - &quot;5000:5000&quot;    networks:      - app-net  redis:    image: &quot;redis:alpine&quot;    networks:      - app-netnetworks:  app-net:    driver: bridge\n\n\n(1)通过docker compose创建容器\n\n1docker-compose up -d\n\n\n(2)访问测试\n\n6.5 详解docker-compose.yml文件\n(1)version: ‘3’\n\n1表示docker-compose的版本\n\n\n(2)services\n\n1一个service表示一个container\n\n\n(3)networks\n\n1相当于docker network create app-net\n\n\n(4)volumes\n\n1相当于-v v1:/var/lib/mysql\n\n\n(5)image\n\n1表示使用哪个镜像，本地build则用build，远端则用image\n\n\n(6)ports\n\n1相当于-p 8080:8080\n\n\n(7)environment\n\n1相当于-e \n\n6.6 docker-compose常见操作123456789101112131415161718192021222324252627282930313233(1)查看版本\tdocker-compose version(2)根据yml创建service\tdocker-compose up\t指定yaml：docker-compose  up -f xxx.yaml\t后台运行：docker-compose up(3)查看启动成功的service\tdocker-compose ps\t也可以使用docker ps(4)查看images\tdocker-compose images(5)停止/启动service\tdocker-compose stop/start (6)删除service[同时会删除掉network和volume]\tdocker-compose down(7)进入到某个service\tdocker-compose exec redis sh\n\n6.7 scale扩缩容\n(1)修改docker-compose.yaml文件，主要是把web的ports去掉，不然会报错\n\n123456789101112131415version: &#x27;3&#x27;services:  web:    build: .    networks:      - app-net  redis:    image: &quot;redis:alpine&quot;    networks:      - app-netnetworks:  app-net:    driver: bridge\n\n\n(2)创建service\n\n1docker-compose up -d\n\n\n(3)若要对python容器进行扩缩容\n\n123docker-compose up --scale web=5 -ddocker-compose psdocker-compose logs web\n\n07 Docker Swarm\n官网：https://docs.docker.com/swarm/\n\n7.1 Install Swarm7.1.1 环境准备\n(1)根据Vagrantfile创建3台centos机器\n[大家可以根据自己实际的情况准备3台centos机器，不一定要使用vagrant+virtualbox]\n新建swarm-docker-centos7文件夹，创建Vagrantfile\n\n1234567891011121314151617181920212223242526272829303132333435363738394041424344boxes = [    &#123;        :name =&gt; &quot;manager-node&quot;,        :eth1 =&gt; &quot;192.168.0.11&quot;,        :mem =&gt; &quot;1024&quot;,        :cpu =&gt; &quot;1&quot;    &#125;,    &#123;        :name =&gt; &quot;worker01-node&quot;,        :eth1 =&gt; &quot;192.168.0.12&quot;,        :mem =&gt; &quot;1024&quot;,        :cpu =&gt; &quot;1&quot;    &#125;,    &#123;        :name =&gt; &quot;worker02-node&quot;,        :eth1 =&gt; &quot;192.168.0.13&quot;,        :mem =&gt; &quot;1024&quot;,        :cpu =&gt; &quot;1&quot;    &#125;]Vagrant.configure(2) do |config|  config.vm.box = &quot;centos/7&quot;     boxes.each do |opts|      config.vm.define opts[:name] do |config|        config.vm.hostname = opts[:name]        config.vm.provider &quot;vmware_fusion&quot; do |v|          v.vmx[&quot;memsize&quot;] = opts[:mem]          v.vmx[&quot;numvcpus&quot;] = opts[:cpu]        end        config.vm.provider &quot;virtualbox&quot; do |v|          v.customize [&quot;modifyvm&quot;, :id, &quot;--memory&quot;, opts[:mem]]\t\t  v.customize [&quot;modifyvm&quot;, :id, &quot;--cpus&quot;, opts[:cpu]]\t\t  v.customize [&quot;modifyvm&quot;, :id, &quot;--name&quot;, opts[:name]]        end        config.vm.network :public_network, ip: opts[:eth1]      end  endend\n\n\n(2)进入到对应的centos里面，使得root账户能够登陆，从而使用XShell登陆\n\n123456vagrant ssh manager-node/worker01-node/worker02-nodesudo -ivi /etc/ssh/sshd_config修改PasswordAuthentication yespasswd    修改密码systemctl restart sshd\n\n\n(3)在win上ping一下各个主机，看是否能ping通\n\n1ping 192.168.0.11/12/13\n\n\n(4)在每台机器上安装docker engine\n小技巧：要想让每个shell窗口一起执行同样的命令”查看–&gt;撰写–&gt;撰写窗口–&gt;全部会话”\n\n7.1.2 搭建Swarm集群\n(1)进入manager\n提示：manager node也可以作为worker node提供服务\n\n1docker swarm init --advertise-addr=192.168.0.11\n\n注意观察日志，拿到worker node加入manager node的信息\n1docker swarm join --token SWMTKN-1-0a5ph4nehwdm9wzcmlbj2ckqqso38pkd238rprzwcoawabxtdq-arcpra6yzltedpafk3qyvv0y3 192.168.0.11:2377\n\n\n(2)进入两个worker\n\n1docker swarm join --token SWMTKN-1-0a5ph4nehwdm9wzcmlbj2ckqqso38pkd238rprzwcoawabxtdq-arcpra6yzltedpafk3qyvv0y3 192.168.0.11:2377\n\n日志打印\n1This node joined a swarm as a worker.\n\n\n(3)进入到manager node查看集群状态\n\n1docker node ls\n\n\n(4)node类型的转换\n可以将worker提升成manager，从而保证manager的高可用\n\n12345docker node promote worker01-nodedocker node promote worker02-node#降级可以用demotedocker node demote worker01-node\n\n7.1.3 在线的\nhttp://labs.play-with-docker.com\n\n7.2 Swarm基本操作7.2.1 Service\n(1)创建一个tomcat的service\n\n1docker service create --name my-tomcat tomcat\n\n\n(2)查看当前swarm的service\n\n1docker service ls\n\n\n(3)查看service的启动日志\n\n1docker service logs my-tomcat\n\n\n(4)查看service的详情\n\n1docker service inspect my-tomcat\n\n\n(5)查看my-tomcat运行在哪个node上\n\n1docker service ps my-tomcat\n\n日志\n12ID                  NAME                IMAGE               NODE                DESIRED STATE       CURRENT STATE           ERROR               PORTSu6o4mz4tj396        my-tomcat.1         tomcat:latest       worker01-node       Running             Running 3 minutes ago  \n\n\n(6)水平扩展service\n\n123docker service scale my-tomcat=3docker service lsdocker service ps my-tomcat\n\n日志：可以发现，其他node上都运行了一个my-tomcat的service\n12345[root@manager-node ~]# docker service ps my-tomcatID                  NAME                IMAGE               NODE                DESIRED STATE       CURRENT STATE            ERROR               PORTSu6o4mz4tj396        my-tomcat.1         tomcat:latest       worker01-node       Running             Running 8 minutes ago                        v505wdu3fxqo        my-tomcat.2         tomcat:latest       manager-node        Running             Running 46 seconds ago                       wpbsilp62sc0        my-tomcat.3         tomcat:latest       worker02-node       Running             Running 49 seconds ago  \n\n此时到worker01-node上：docker ps，可以发现container的name和service名称不一样，这点要知道\n12CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMESbc4b9bb097b8        tomcat:latest       &quot;catalina.sh run&quot;   10 minutes ago      Up 10 minutes       8080/tcp            my-tomcat.1.u6o4mz4tj3969a1p3mquagxok\n\n\n(7)如果某个node上的my-tomcat挂掉了，这时候会自动扩展\n\n123456[worker01-node]docker rm -f containerid[manager-node]docker service lsdocker service ps my-tomcat\n\n\n(8)删除service\n\n1docker service rm my-tomcat\n\n7.2.2 多机通信overlay网络[3.7的延续]\n业务场景：workpress+mysql实现个人博客搭建\n\nhttps://hub.docker.com/_/wordpress?tab=description\n\n\n7.2.2.1 传统手动方式实现7.2.2.1.1 一台centos上，分别创建容器123456789101101-创建mysql容器[创建完成等待一会，注意mysql的版本]\tdocker run -d --name mysql -v v1:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=examplepass -e MYSQL_DATABASE=db_wordpress mysql:5.6\t02-创建wordpress容器[将wordpress的80端口映射到centos的8080端口]\tdocker run -d --name wordpress --link mysql -e WORDPRESS_DB_HOST=mysql:3306 -e WORDPRESS_DB_USER=root -e WORDPRESS_DB_PASSWORD=examplepass -e WORDPRESS_DB_NAME=db_wordpress -p 8080:80 wordpress\t03-查看默认bridge的网络，可以发现两个容器都在其中\tdocker network inspect bridge\t04-访问测试\twin浏览器中输入：ip[centos]:8080，一直下一步\n\n7.2.2.1.2 使用docker compose创建\ndocker-compose的方式还是在一台机器中，网络这块很清晰\n\n1234501-创建wordpress-mysql文件夹\tmkdir -p /tmp/wordpress-mysql\tcd /tmp/wordpress-mysql\t02-创建docker-compose.yml文件\n\n文件内容\n12345678910111213141516171819202122232425262728293031version: &#x27;3.1&#x27;services:  wordpress:    image: wordpress    restart: always    ports:      - 8080:80    environment:      WORDPRESS_DB_HOST: db      WORDPRESS_DB_USER: exampleuser      WORDPRESS_DB_PASSWORD: examplepass      WORDPRESS_DB_NAME: exampledb    volumes:      - wordpress:/var/www/html  db:    image: mysql:5.7    restart: always    environment:      MYSQL_DATABASE: exampledb      MYSQL_USER: exampleuser      MYSQL_PASSWORD: examplepass      MYSQL_RANDOM_ROOT_PASSWORD: &#x27;1&#x27;    volumes:      - db:/var/lib/mysqlvolumes:  wordpress:  db:\n\n12345678903-根据docker-compose.yml文件创建service\tdocker-compose up -d\t04-访问测试\twin10浏览器ip[centos]:8080，一直下一步\t05-值得关注的点是网络\tdocker network ls\tdocker network inspect wordpress-mysql_default\n\n7.2.2.2 Swarm中实现\n还是wordpress+mysql的案例，在docker swarm集群中怎么玩呢？\n\n\n(1)创建一个overlay网络，用于docker swarm中多机通信\n\n1234【manager-node】docker network create -d overlay my-overlay-netdocker network ls[此时worker node查看不到]\n\n\n(2)创建mysql的service\n\n1234567【manager-node】01-创建servicedocker service create --name mysql --mount type=volume,source=v1,destination=/var/lib/mysql --env MYSQL_ROOT_PASSWORD=examplepass --env MYSQL_DATABASE=db_wordpress --network my-overlay-net mysql:5.602-查看service\tdocker service ls\tdocker service ps mysql\n\n\n(3)创建wordpress的service\n\n1234567801-创建service  [注意之所以下面可以通过mysql名字访问，也是因为有DNS解析]docker service create --name wordpress --env WORDPRESS_DB_USER=root --env WORDPRESS_DB_PASSWORD=examplepass --env WORDPRESS_DB_HOST=mysql:3306 --env WORDPRESS_DB_NAME=db_wordpress -p 8080:80 --network my-overlay-net wordpress02-查看service\tdocker service ls\tdocker service ps mysql\t03-此时mysql和wordpress的service运行在哪个node上，这时候就能看到my-overlay-net的网络\n\n\n(4)测试\n\n1win浏览器访问ip[manager/worker01/worker02]:8080都能访问成功\n\n\n(5)查看my-overlay-net\n\n1docker network inspect my-overlay-net\n\n\n(6)为什么没有用etcd？docker swarm中有自己的分布式存储机制\n\n7.3 Routing Mesh7.3.1 Ingress\n通过前面的案例我们发现，部署一个wordpress的service，映射到主机的8080端口，这时候通过swarm集群中的任意主机ip:8080都能成功访问，这是因为什么？\n把问题简化：docker service create –name tomcat -p 8080:8080 –network my-overlay-net tomcat\n\n\n(1)记得使用一个自定义的overlay类型的网络\n\n1--network my-overlay-net\n\n\n(2)查看service情况\n\n12docker service lsdocker service ps tomcat\n\n\n(3)访问3台机器的ip:8080测试\n\n1发现都能够访问到tomcat的欢迎页\n\n7.4.2 Internal\n之前在实战wordpress+mysql的时候，发现wordpress中可以直接通过mysql名称访问\n这样可以说明两点，第一是其中一定有dns解析，第二是两个service的ip是能够ping通的\n思考：不妨再创建一个service，也同样使用上述tomcat的overlay网络，然后来实验\ndocker service create –name whoami -p 8000:8000 –network my-overlay-net -d jwilder&#x2F;whoami\n\n\n(1)查看whoami的情况\n\n1docker service ps whoami\n\n\n(2)在各自容器中互相ping一下彼此，也就是容器间的通信\n\n12345678910#tomcat容器中ping whoamidocker exec -it 9d7d4c2b1b80 ping whoami64 bytes from bogon (10.0.0.8): icmp_seq=1 ttl=64 time=0.050 ms64 bytes from bogon (10.0.0.8): icmp_seq=2 ttl=64 time=0.080 ms#whoami容器中ping tomcatdocker exec -it 5c4fe39e7f60 ping tomcat64 bytes from bogon (10.0.0.18): icmp_seq=1 ttl=64 time=0.050 ms64 bytes from bogon (10.0.0.18): icmp_seq=2 ttl=64 time=0.080 ms\n\n\n(3)将whoami进行扩容\n\n12docker service scale whoami=3docker service ps whoami     #manager,worker01,worker02\n\n\n(4)此时再ping whoami service，并且访问whoami服务\n\n12345678910#pingdocker exec -it 9d7d4c2b1b80 ping whoami64 bytes from bogon (10.0.0.8): icmp_seq=1 ttl=64 time=0.055 ms64 bytes from bogon (10.0.0.8): icmp_seq=2 ttl=64 time=0.084 ms#访问docker exec -it 9d7d4c2b1b80 curl whoami:8000  [多访问几次]I&#x27;m 09f4158c81aeI&#x27;m aebc574dc990I&#x27;m 7755bc7da921\n\n小结：通过上述的实验可以发现什么？whoami服务对其他服务暴露的ip是不变的，但是通过whoami名称访问8000端口，确实访问到的是不同的service，就说明访问其实是像下面这张图。\n也就是说whoami service对其他服务提供了一个统一的VIP入口，别的服务访问时会做负载均衡。\n7.5 Stack\ndocker stack deploy：https://docs.docker.com/engine/reference/commandline/stack_deploy/\ncompose-file：https://docs.docker.com/compose/compose-file/\n有没有发现上述部署service很麻烦？要是能够类似于docker-compose.yml文件那种方式一起管理该多少？这就要涉及到dockerswarm中的Stack，我们直接通过前面的wordpress+mysql案例看看怎么使用咯。\n\n\n(1)新建service.yml文件\n\n12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152version: &#x27;3&#x27;services:  wordpress:    image: wordpress    ports:      - 8080:80    environment:      WORDPRESS_DB_HOST: db      WORDPRESS_DB_USER: exampleuser      WORDPRESS_DB_PASSWORD: examplepass      WORDPRESS_DB_NAME: exampledb    networks:      - ol-net    volumes:      - wordpress:/var/www/html    deploy:      mode: replicated      replicas: 3      restart_policy:        condition: on-failure        delay: 5s        max_attempts: 3      update_config:        parallelism: 1        delay: 10s  db:    image: mysql:5.7    environment:      MYSQL_DATABASE: exampledb      MYSQL_USER: exampleuser      MYSQL_PASSWORD: examplepass      MYSQL_RANDOM_ROOT_PASSWORD: &#x27;1&#x27;    volumes:      - db:/var/lib/mysql    networks:      - ol-net    deploy:      mode: global      placement:        constraints:          - node.role == managervolumes:  wordpress:  db:networks:  ol-net:    driver: overlay\n\n\n(2)根据service.yml创建service\n\n1docker statck deploy -c service.yml my-service\n\n\n(3)常见操作\n\n12345678910111213141516171819202122232425262701-查看stack具体信息\tdocker stack ls\tNAME                SERVICES            ORCHESTRATOR\tmy-service          2                   Swarm\t02-查看具体的service\tdocker stack services my-service\tID                  NAME                   MODE                REPLICAS            IMAGE               PORTSicraimlesu61        my-service_db          global              1/1                 mysql:5.7           iud2g140za5c        my-service_wordpress   replicated          3/3                 wordpress:latest    *:8080-&gt;80/tcp03-查看某个service\tdocker service inspect my-service-db\t&quot;Endpoint&quot;: &#123;            &quot;Spec&quot;: &#123;                &quot;Mode&quot;: &quot;vip&quot;            &#125;,            &quot;VirtualIPs&quot;: [                &#123;                    &quot;NetworkID&quot;: &quot;kz1reu3yxxpwp1lvnrraw0uq6&quot;,                    &quot;Addr&quot;: &quot;10.0.1.5/24&quot;                &#125;            ]        &#125;\n\n\n(4)访问测试\n\nwin浏览器ip[manager,worker01,worker02]:8080","dateCreated":"2019-11-23T11:38:06+08:00","dateModified":"2024-09-01T21:22:26+08:00","datePublished":"2019-11-23T11:38:06+08:00","description":"Docker Compose与Docker Swarm","headline":"五、(Docker系列)Docker深度提升篇笔记","image":["https://5b868fd.webp.li/docker-conver.png","http://pic.tsmp4.net/api/fengjing/img.php"],"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.biwin.eu.org/posts/525c4592.html"},"publisher":{"@type":"Organization","name":"Mr.WangLi","sameAs":["https://github.com/biwin-wangli","http://stackoverflow.com/users","https://www.linkedin.com/profile/","mailto:274027703@qq.com"],"image":"https://img.biwin.eu.org/touxiang.jpeg","logo":{"@type":"ImageObject","url":"https://img.biwin.eu.org/touxiang.jpeg"}},"url":"https://blog.biwin.eu.org/posts/525c4592.html","keywords":"docker","thumbnailUrl":"https://5b868fd.webp.li/docker-conver.png"}</script>
    <meta name="description" content="五、Docker深度提升篇笔记">
<meta property="og:type" content="blog">
<meta property="og:title" content="五、(Docker系列)Docker深度提升篇笔记">
<meta property="og:url" content="https://blog.biwin.eu.org/posts/525c4592.html">
<meta property="og:site_name" content="BiWin&#39;s Blog">
<meta property="og:description" content="五、Docker深度提升篇笔记">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2019-11-23T03:38:06.000Z">
<meta property="article:modified_time" content="2024-09-01T13:22:26.058Z">
<meta property="article:author" content="Mr.WangLi">
<meta property="article:tag" content="docker">
<meta name="twitter:card" content="summary">
    
    
        
    
    
        <meta property="og:image" content="https://img.biwin.eu.org/touxiang.jpeg"/>
    
    
        <meta property="og:image" content="https://5b868fd.webp.li/docker-conver.png"/>
        <meta class="swiftype" name="image" data-type="enum" content="https://5b868fd.webp.li/docker-conver.png"/>
    
    
        <meta property="og:image" content="http://pic.tsmp4.net/api/fengjing/img.php"/>
        <meta class="swiftype" name="image" data-type="enum" content="http://pic.tsmp4.net/api/fengjing/img.php"/>
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/style-vfgvchqkdym9obx7tmwvvzqxiypypaaj66luf6y7bb4kfhuqzb8eonjh8v3p.min.css">

    <!--STYLES END-->
    

    

    
        
    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="4">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/"
            aria-label=""
        >
            BiWin&#39;s Blog
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="打开链接: /#about"
            >
        
        
            <img class="header-picture" src="https://img.biwin.eu.org/touxiang.jpeg" alt="作者的图片"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="4">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a
                    href="/#about"
                    aria-label="阅读有关作者的更多信息"
                >
                    <img class="sidebar-profile-picture" src="https://img.biwin.eu.org/touxiang.jpeg" alt="作者的图片"/>
                </a>
                <h4 class="sidebar-profile-name">Mr.WangLi</h4>
                
                    <h5 class="sidebar-profile-bio"><p>喜欢技术，喜欢一个人！</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="首页"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">首页</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-categories"
                            
                            rel="noopener"
                            title="分类"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">分类</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="标签"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">标签</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-archives"
                            
                            rel="noopener"
                            title="归档"
                        >
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">归档</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link open-algolia-search"
                            href="#search"
                            
                            rel="noopener"
                            title="搜索"
                        >
                        <i class="sidebar-button-icon fa fa-search" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">搜索</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="#about"
                            
                            rel="noopener"
                            title="关于"
                        >
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">关于</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/biwin-wangli"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="http://stackoverflow.com/users"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Stack Overflow"
                        >
                        <i class="sidebar-button-icon fab fa-stack-overflow" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Stack Overflow</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://www.linkedin.com/profile/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="LinkedIn"
                        >
                        <i class="sidebar-button-icon fab fa-linkedin" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">LinkedIn</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="mailto:274027703@qq.com"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="邮箱"
                        >
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">邮箱</span>
                    </a>
            </li>
            
        </ul>
        
        <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=110 src="//music.163.com/outchain/player?type=0&id=3132987672&auto=1&height=90"></iframe>
    </div>
</nav>

            
        <div class="post-header-cover
                    text-center
                    post-header-cover--full"
             style="background-image:url('http://pic.tsmp4.net/api/fengjing/img.php');"
             data-behavior="4">
            
                <div class="post-header main-content-wrap text-center">
    
        <h1 class="post-title">
            五、(Docker系列)Docker深度提升篇笔记
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2019-11-23T11:38:06+08:00">
	
		    2019 年 11 月 23 日
    	
    </time>
    
        <span>发布在 </span>
        
    <a class="category-link" href="/categories/devOps/">devOps</a>


    
</div>

        
    
    
        <!-- 不蒜子统计 -->
        <span id="busuanzi_container_page_pv" style='display:none' class="post-meta">
	        <i class="icon-smile icon"></i> 阅读数：<span id="busuanzi_value_page_pv"></span>次
	    </span>
    
</div>

            
        </div>

            <div id="main" data-behavior="4"
                 class="hasCover
                        hasCoverMetaIn
                        hasCoverCaption">
                
<article class="post">
    
        <span class="post-header-cover-caption caption">再繁忙的学习，也需要静一会下来，放松自己，欣赏美丽的风景</span>
    
    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <!-- excerpt -->
<h1 id="table-of-contents">目录</h1><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Docker-Compose"><span class="toc-text">Docker Compose</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#6-1-%E4%B8%9A%E5%8A%A1%E8%83%8C%E6%99%AF"><span class="toc-text">6.1 业务背景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-2-Docker%E4%BC%A0%E7%BB%9F%E6%96%B9%E5%BC%8F%E5%AE%9E%E7%8E%B0"><span class="toc-text">6.2 Docker传统方式实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-1-%E5%86%99Python%E4%BB%A3%E7%A0%81-build-image"><span class="toc-text">6.2.1 写Python代码&amp;build image</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-2-%E8%8E%B7%E5%8F%96Redis%E7%9A%84image"><span class="toc-text">6.2.2 获取Redis的image</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-3-%E5%88%9B%E5%BB%BA%E4%B8%A4%E4%B8%AAcontainer"><span class="toc-text">6.2.3 创建两个container</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-4-%E8%AE%BF%E9%97%AE%E6%B5%8B%E8%AF%95"><span class="toc-text">6.2.4 访问测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-3-%E7%AE%80%E4%BB%8B%E5%92%8C%E5%AE%89%E8%A3%85"><span class="toc-text">6.3 简介和安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-1-%E7%AE%80%E4%BB%8B"><span class="toc-text">6.3.1 简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-2-%E5%AE%89%E8%A3%85"><span class="toc-text">6.3.2 安装</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-4-docker-compose%E5%AE%9E%E7%8E%B0"><span class="toc-text">6.4 docker compose实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-1-%E5%90%8C%E6%A0%B7%E7%9A%84%E5%89%8D%E6%9C%9F%E5%87%86%E5%A4%87"><span class="toc-text">6.4.1 同样的前期准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-2-%E7%BC%96%E5%86%99docker-compose-yaml%E6%96%87%E4%BB%B6"><span class="toc-text">6.4.2 编写docker-compose.yaml文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-5-%E8%AF%A6%E8%A7%A3docker-compose-yml%E6%96%87%E4%BB%B6"><span class="toc-text">6.5 详解docker-compose.yml文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-6-docker-compose%E5%B8%B8%E8%A7%81%E6%93%8D%E4%BD%9C"><span class="toc-text">6.6 docker-compose常见操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-7-scale%E6%89%A9%E7%BC%A9%E5%AE%B9"><span class="toc-text">6.7 scale扩缩容</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#07-Docker-Swarm"><span class="toc-text">07 Docker Swarm</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#7-1-Install-Swarm"><span class="toc-text">7.1 Install Swarm</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-1-%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-text">7.1.1 环境准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-2-%E6%90%AD%E5%BB%BASwarm%E9%9B%86%E7%BE%A4"><span class="toc-text">7.1.2 搭建Swarm集群</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-3-%E5%9C%A8%E7%BA%BF%E7%9A%84"><span class="toc-text">7.1.3 在线的</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-2-Swarm%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-text">7.2 Swarm基本操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-1-Service"><span class="toc-text">7.2.1 Service</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-2-%E5%A4%9A%E6%9C%BA%E9%80%9A%E4%BF%A1overlay%E7%BD%91%E7%BB%9C-3-7%E7%9A%84%E5%BB%B6%E7%BB%AD"><span class="toc-text">7.2.2 多机通信overlay网络[3.7的延续]</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-2-1-%E4%BC%A0%E7%BB%9F%E6%89%8B%E5%8A%A8%E6%96%B9%E5%BC%8F%E5%AE%9E%E7%8E%B0"><span class="toc-text">7.2.2.1 传统手动方式实现</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#7-2-2-1-1-%E4%B8%80%E5%8F%B0centos%E4%B8%8A%EF%BC%8C%E5%88%86%E5%88%AB%E5%88%9B%E5%BB%BA%E5%AE%B9%E5%99%A8"><span class="toc-text">7.2.2.1.1 一台centos上，分别创建容器</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#7-2-2-1-2-%E4%BD%BF%E7%94%A8docker-compose%E5%88%9B%E5%BB%BA"><span class="toc-text">7.2.2.1.2 使用docker compose创建</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-2-2-Swarm%E4%B8%AD%E5%AE%9E%E7%8E%B0"><span class="toc-text">7.2.2.2 Swarm中实现</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-3-Routing-Mesh"><span class="toc-text">7.3 Routing Mesh</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-1-Ingress"><span class="toc-text">7.3.1 Ingress</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-4-2-Internal"><span class="toc-text">7.4.2 Internal</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-5-Stack"><span class="toc-text">7.5 Stack</span></a></li></ol></li></ol>

<h1 id="Docker-Compose"><a href="#Docker-Compose" class="headerlink" title="Docker Compose"></a>Docker Compose</h1><blockquote>
<p><code>官网</code>：<a target="_blank" rel="noopener" href="https://docs.docker.com/compose/">https://docs.docker.com/compose/</a></p>
</blockquote>
<h2 id="6-1-业务背景"><a href="#6-1-业务背景" class="headerlink" title="6.1 业务背景"></a>6.1 业务背景</h2><h2 id="6-2-Docker传统方式实现"><a href="#6-2-Docker传统方式实现" class="headerlink" title="6.2 Docker传统方式实现"></a>6.2 Docker传统方式实现</h2><h3 id="6-2-1-写Python代码-build-image"><a href="#6-2-1-写Python代码-build-image" class="headerlink" title="6.2.1 写Python代码&amp;build image"></a>6.2.1 写Python代码&amp;build image</h3><blockquote>
<p>(1)创建文件夹</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /tmp/composetest</span><br><span class="line">cd /tmp/composetest</span><br></pre></td></tr></table></figure>

<blockquote>
<p>(2)创建app.py文件，写业务内容</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">cache = redis.Redis(host=<span class="string">&#x27;redis&#x27;</span>, port=<span class="number">6379</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_hit_count</span>():</span><br><span class="line">    retries = <span class="number">5</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> cache.incr(<span class="string">&#x27;hits&#x27;</span>)</span><br><span class="line">        <span class="keyword">except</span> redis.exceptions.ConnectionError <span class="keyword">as</span> exc:</span><br><span class="line">            <span class="keyword">if</span> retries == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">raise</span> exc</span><br><span class="line">            retries -= <span class="number">1</span></span><br><span class="line">            time.sleep(<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello</span>():</span><br><span class="line">    count = get_hit_count()</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello World! I have been seen &#123;&#125; times.\n&#x27;</span>.<span class="built_in">format</span>(count)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>(3)新建requirements.txt文件</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flask</span><br><span class="line">redis</span><br></pre></td></tr></table></figure>

<blockquote>
<p>(4)编写Dockerfile</p>
</blockquote>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> python:<span class="number">3.7</span>-alpine</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /code</span></span><br><span class="line"><span class="keyword">ENV</span> FLASK_APP app.py</span><br><span class="line"><span class="keyword">ENV</span> FLASK_RUN_HOST <span class="number">0.0</span>.<span class="number">0.0</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apk add --no-cache gcc musl-dev linux-headers</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> requirements.txt requirements.txt</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> pip install -r requirements.txt</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> . .</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;flask&quot;</span>, <span class="string">&quot;run&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>(5)根据Dockerfile生成image</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t python-app-image .</span><br></pre></td></tr></table></figure>

<blockquote>
<p>(6)查看images：docker images</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python-app-image latest 7e1d81f366b7 3 minutes ago  213MB</span><br></pre></td></tr></table></figure>

<h3 id="6-2-2-获取Redis的image"><a href="#6-2-2-获取Redis的image" class="headerlink" title="6.2.2 获取Redis的image"></a>6.2.2 获取Redis的image</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull redis:alpine</span><br></pre></td></tr></table></figure>

<h3 id="6-2-3-创建两个container"><a href="#6-2-3-创建两个container" class="headerlink" title="6.2.3 创建两个container"></a>6.2.3 创建两个container</h3><blockquote>
<p>(1)创建网络</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker network ls</span><br><span class="line">docker network create --subnet=172.20.0.0/24 app-net </span><br></pre></td></tr></table></figure>

<blockquote>
<p>(1)创建python程序的container，并指定网段和端口</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name web -p 5000:5000 --network app-net python-app-image</span><br></pre></td></tr></table></figure>

<blockquote>
<p>(2)创建redis的container，并指定网段</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name redis --network app-net redis:alpine</span><br></pre></td></tr></table></figure>

<h3 id="6-2-4-访问测试"><a href="#6-2-4-访问测试" class="headerlink" title="6.2.4 访问测试"></a>6.2.4 访问测试</h3><p>ip[centos]:5000</p>
<h2 id="6-3-简介和安装"><a href="#6-3-简介和安装" class="headerlink" title="6.3 简介和安装"></a>6.3 简介和安装</h2><h3 id="6-3-1-简介"><a href="#6-3-1-简介" class="headerlink" title="6.3.1 简介"></a>6.3.1 简介</h3><blockquote>
<p><code>官网</code>：<a target="_blank" rel="noopener" href="https://docs.docker.com/compose/">https://docs.docker.com/compose/</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Compose is a tool for defining and running multi-container Docker applications. With Compose, you use a YAML file to configure your application’s services. Then, with a single command, you create and start all the services from your configuration.</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="6-3-2-安装"><a href="#6-3-2-安装" class="headerlink" title="6.3.2 安装"></a>6.3.2 安装</h3><blockquote>
<p>Linux环境中需要单独安装</p>
<p><code>官网</code>：<a target="_blank" rel="noopener" href="https://docs.docker.com/compose/install/">https://docs.docker.com/compose/install/</a></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo curl -L &quot;https://github.com/docker/compose/releases/download/1.24.1/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod +x /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure>

<h2 id="6-4-docker-compose实现"><a href="#6-4-docker-compose实现" class="headerlink" title="6.4 docker compose实现"></a>6.4 docker compose实现</h2><blockquote>
<p><code>reference</code>：<a target="_blank" rel="noopener" href="https://docs.docker.com/compose/gettingstarted/">https://docs.docker.com/compose/gettingstarted/</a></p>
</blockquote>
<h3 id="6-4-1-同样的前期准备"><a href="#6-4-1-同样的前期准备" class="headerlink" title="6.4.1 同样的前期准备"></a>6.4.1 同样的前期准备</h3><p>新建目录，比如composetest</p>
<p>进入目录，编写app.py代码</p>
<p>创建requirements.txt文件</p>
<p>编写Dockerfile</p>
<h3 id="6-4-2-编写docker-compose-yaml文件"><a href="#6-4-2-编写docker-compose-yaml文件" class="headerlink" title="6.4.2 编写docker-compose.yaml文件"></a>6.4.2 编写docker-compose.yaml文件</h3><p>默认名称，当然也可以指定，<code>docker-compose.yaml</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">web:</span></span><br><span class="line">    <span class="attr">build:</span> <span class="string">.</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;5000:5000&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">app-net</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">&quot;redis:alpine&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">app-net</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">app-net:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">bridge</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>(1)通过docker compose创建容器</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>

<blockquote>
<p>(2)访问测试</p>
</blockquote>
<h2 id="6-5-详解docker-compose-yml文件"><a href="#6-5-详解docker-compose-yml文件" class="headerlink" title="6.5 详解docker-compose.yml文件"></a>6.5 详解docker-compose.yml文件</h2><blockquote>
<p>(1)version: ‘3’</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">表示docker-compose的版本</span><br></pre></td></tr></table></figure>

<blockquote>
<p>(2)services</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">一个service表示一个container</span><br></pre></td></tr></table></figure>

<blockquote>
<p>(3)networks</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">相当于docker network create app-net</span><br></pre></td></tr></table></figure>

<blockquote>
<p>(4)volumes</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">相当于-v v1:/var/lib/mysql</span><br></pre></td></tr></table></figure>

<blockquote>
<p>(5)image</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">表示使用哪个镜像，本地build则用build，远端则用image</span><br></pre></td></tr></table></figure>

<blockquote>
<p>(6)ports</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">相当于-p 8080:8080</span><br></pre></td></tr></table></figure>

<blockquote>
<p>(7)environment</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">相当于-e </span><br></pre></td></tr></table></figure>

<h2 id="6-6-docker-compose常见操作"><a href="#6-6-docker-compose常见操作" class="headerlink" title="6.6 docker-compose常见操作"></a>6.6 docker-compose常见操作</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">(1)查看版本</span><br><span class="line"></span><br><span class="line">	docker-compose version</span><br><span class="line"></span><br><span class="line">(2)根据yml创建service</span><br><span class="line"></span><br><span class="line">	docker-compose up</span><br><span class="line"></span><br><span class="line">	指定yaml：docker-compose  up -f xxx.yaml</span><br><span class="line"></span><br><span class="line">	后台运行：docker-compose up</span><br><span class="line"></span><br><span class="line">(3)查看启动成功的service</span><br><span class="line"></span><br><span class="line">	docker-compose ps</span><br><span class="line"></span><br><span class="line">	也可以使用docker ps</span><br><span class="line"></span><br><span class="line">(4)查看images</span><br><span class="line"></span><br><span class="line">	docker-compose images</span><br><span class="line"></span><br><span class="line">(5)停止/启动service</span><br><span class="line"></span><br><span class="line">	docker-compose stop/start </span><br><span class="line"></span><br><span class="line">(6)删除service[同时会删除掉network和volume]</span><br><span class="line"></span><br><span class="line">	docker-compose down</span><br><span class="line"></span><br><span class="line">(7)进入到某个service</span><br><span class="line"></span><br><span class="line">	docker-compose exec redis sh</span><br></pre></td></tr></table></figure>

<h2 id="6-7-scale扩缩容"><a href="#6-7-scale扩缩容" class="headerlink" title="6.7 scale扩缩容"></a>6.7 scale扩缩容</h2><blockquote>
<p>(1)修改docker-compose.yaml文件，主要是把web的ports去掉，不然会报错</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">web:</span></span><br><span class="line">    <span class="attr">build:</span> <span class="string">.</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">app-net</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">&quot;redis:alpine&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">app-net</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">app-net:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">bridge</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>(2)创建service</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>

<blockquote>
<p>(3)若要对python容器进行扩缩容</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up --scale web=5 -d</span><br><span class="line">docker-compose ps</span><br><span class="line">docker-compose logs web</span><br></pre></td></tr></table></figure>

<h1 id="07-Docker-Swarm"><a href="#07-Docker-Swarm" class="headerlink" title="07 Docker Swarm"></a>07 Docker Swarm</h1><blockquote>
<p><code>官网</code>：<a target="_blank" rel="noopener" href="https://docs.docker.com/swarm/">https://docs.docker.com/swarm/</a></p>
</blockquote>
<h2 id="7-1-Install-Swarm"><a href="#7-1-Install-Swarm" class="headerlink" title="7.1 Install Swarm"></a>7.1 Install Swarm</h2><h3 id="7-1-1-环境准备"><a href="#7-1-1-环境准备" class="headerlink" title="7.1.1 环境准备"></a>7.1.1 环境准备</h3><blockquote>
<p>(1)根据Vagrantfile创建3台centos机器</p>
<p>[<strong>大家可以根据自己实际的情况准备3台centos机器，不一定要使用vagrant+virtualbox</strong>]</p>
<p>新建swarm-docker-centos7文件夹，创建Vagrantfile</p>
</blockquote>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">boxes = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="symbol">:name</span> =&gt; <span class="string">&quot;manager-node&quot;</span>,</span><br><span class="line">        <span class="symbol">:eth1</span> =&gt; <span class="string">&quot;192.168.0.11&quot;</span>,</span><br><span class="line">        <span class="symbol">:mem</span> =&gt; <span class="string">&quot;1024&quot;</span>,</span><br><span class="line">        <span class="symbol">:cpu</span> =&gt; <span class="string">&quot;1&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="symbol">:name</span> =&gt; <span class="string">&quot;worker01-node&quot;</span>,</span><br><span class="line">        <span class="symbol">:eth1</span> =&gt; <span class="string">&quot;192.168.0.12&quot;</span>,</span><br><span class="line">        <span class="symbol">:mem</span> =&gt; <span class="string">&quot;1024&quot;</span>,</span><br><span class="line">        <span class="symbol">:cpu</span> =&gt; <span class="string">&quot;1&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="symbol">:name</span> =&gt; <span class="string">&quot;worker02-node&quot;</span>,</span><br><span class="line">        <span class="symbol">:eth1</span> =&gt; <span class="string">&quot;192.168.0.13&quot;</span>,</span><br><span class="line">        <span class="symbol">:mem</span> =&gt; <span class="string">&quot;1024&quot;</span>,</span><br><span class="line">        <span class="symbol">:cpu</span> =&gt; <span class="string">&quot;1&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="title class_">Vagrant</span>.configure(<span class="number">2</span>) <span class="keyword">do</span> |<span class="params">config</span>|</span><br><span class="line"></span><br><span class="line">  config.vm.box = <span class="string">&quot;centos/7&quot;</span></span><br><span class="line">  </span><br><span class="line">   boxes.each <span class="keyword">do</span> |<span class="params">opts</span>|</span><br><span class="line">      config.vm.define opts[<span class="symbol">:name</span>] <span class="keyword">do</span> |<span class="params">config</span>|</span><br><span class="line">        config.vm.hostname = opts[<span class="symbol">:name</span>]</span><br><span class="line">        config.vm.provider <span class="string">&quot;vmware_fusion&quot;</span> <span class="keyword">do</span> |<span class="params">v</span>|</span><br><span class="line">          v.vmx[<span class="string">&quot;memsize&quot;</span>] = opts[<span class="symbol">:mem</span>]</span><br><span class="line">          v.vmx[<span class="string">&quot;numvcpus&quot;</span>] = opts[<span class="symbol">:cpu</span>]</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">        config.vm.provider <span class="string">&quot;virtualbox&quot;</span> <span class="keyword">do</span> |<span class="params">v</span>|</span><br><span class="line">          v.customize [<span class="string">&quot;modifyvm&quot;</span>, <span class="symbol">:id</span>, <span class="string">&quot;--memory&quot;</span>, opts[<span class="symbol">:mem</span>]]</span><br><span class="line">		  v.customize [<span class="string">&quot;modifyvm&quot;</span>, <span class="symbol">:id</span>, <span class="string">&quot;--cpus&quot;</span>, opts[<span class="symbol">:cpu</span>]]</span><br><span class="line">		  v.customize [<span class="string">&quot;modifyvm&quot;</span>, <span class="symbol">:id</span>, <span class="string">&quot;--name&quot;</span>, opts[<span class="symbol">:name</span>]]</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">        config.vm.network <span class="symbol">:public_network</span>, <span class="symbol">ip:</span> opts[<span class="symbol">:eth1</span>]</span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>(2)进入到对应的centos里面，使得root账户能够登陆，从而使用XShell登陆</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vagrant ssh manager-node/worker01-node/worker02-node</span><br><span class="line">sudo -i</span><br><span class="line">vi /etc/ssh/sshd_config</span><br><span class="line">修改PasswordAuthentication yes</span><br><span class="line">passwd    修改密码</span><br><span class="line">systemctl restart sshd</span><br></pre></td></tr></table></figure>

<blockquote>
<p>(3)在win上ping一下各个主机，看是否能ping通</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping 192.168.0.11/12/13</span><br></pre></td></tr></table></figure>

<blockquote>
<p>(4)在每台机器上安装docker engine</p>
<p><code>小技巧</code>：要想让每个shell窗口一起执行同样的命令”查看–&gt;撰写–&gt;撰写窗口–&gt;全部会话”</p>
</blockquote>
<h3 id="7-1-2-搭建Swarm集群"><a href="#7-1-2-搭建Swarm集群" class="headerlink" title="7.1.2 搭建Swarm集群"></a>7.1.2 搭建Swarm集群</h3><blockquote>
<p>(1)进入manager</p>
<p><code>提示</code>：manager node也可以作为worker node提供服务</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker swarm init --advertise-addr=192.168.0.11</span><br></pre></td></tr></table></figure>

<p><code>注意观察日志，拿到worker node加入manager node的信息</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker swarm join --token SWMTKN-1-0a5ph4nehwdm9wzcmlbj2ckqqso38pkd238rprzwcoawabxtdq-arcpra6yzltedpafk3qyvv0y3 192.168.0.11:2377</span><br></pre></td></tr></table></figure>

<blockquote>
<p>(2)进入两个worker</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker swarm join --token SWMTKN-1-0a5ph4nehwdm9wzcmlbj2ckqqso38pkd238rprzwcoawabxtdq-arcpra6yzltedpafk3qyvv0y3 192.168.0.11:2377</span><br></pre></td></tr></table></figure>

<p><code>日志打印</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">This node joined a swarm as a worker.</span><br></pre></td></tr></table></figure>

<blockquote>
<p>(3)进入到manager node查看集群状态</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker node ls</span><br></pre></td></tr></table></figure>

<blockquote>
<p>(4)node类型的转换</p>
<p>可以将worker提升成manager，从而保证manager的高可用</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker node promote worker01-node</span><br><span class="line">docker node promote worker02-node</span><br><span class="line"></span><br><span class="line">#降级可以用demote</span><br><span class="line">docker node demote worker01-node</span><br></pre></td></tr></table></figure>

<h3 id="7-1-3-在线的"><a href="#7-1-3-在线的" class="headerlink" title="7.1.3 在线的"></a>7.1.3 在线的</h3><blockquote>
<p><a target="_blank" rel="noopener" href="http://labs.play-with-docker.com/">http://labs.play-with-docker.com</a></p>
</blockquote>
<h2 id="7-2-Swarm基本操作"><a href="#7-2-Swarm基本操作" class="headerlink" title="7.2 Swarm基本操作"></a>7.2 Swarm基本操作</h2><h3 id="7-2-1-Service"><a href="#7-2-1-Service" class="headerlink" title="7.2.1 Service"></a>7.2.1 Service</h3><blockquote>
<p>(1)创建一个tomcat的service</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker service create --name my-tomcat tomcat</span><br></pre></td></tr></table></figure>

<blockquote>
<p>(2)查看当前swarm的service</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker service ls</span><br></pre></td></tr></table></figure>

<blockquote>
<p>(3)查看service的启动日志</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker service logs my-tomcat</span><br></pre></td></tr></table></figure>

<blockquote>
<p>(4)查看service的详情</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker service inspect my-tomcat</span><br></pre></td></tr></table></figure>

<blockquote>
<p>(5)查看my-tomcat运行在哪个node上</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker service ps my-tomcat</span><br></pre></td></tr></table></figure>

<p><code>日志</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ID                  NAME                IMAGE               NODE                DESIRED STATE       CURRENT STATE           ERROR               PORTS</span><br><span class="line">u6o4mz4tj396        my-tomcat.1         tomcat:latest       worker01-node       Running             Running 3 minutes ago  </span><br></pre></td></tr></table></figure>

<blockquote>
<p>(6)水平扩展service</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker service scale my-tomcat=3</span><br><span class="line">docker service ls</span><br><span class="line">docker service ps my-tomcat</span><br></pre></td></tr></table></figure>

<p><code>日志</code>：可以发现，其他node上都运行了一个my-tomcat的service</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@manager-node ~]# docker service ps my-tomcat</span><br><span class="line">ID                  NAME                IMAGE               NODE                DESIRED STATE       CURRENT STATE            ERROR               PORTS</span><br><span class="line">u6o4mz4tj396        my-tomcat.1         tomcat:latest       worker01-node       Running             Running 8 minutes ago                        </span><br><span class="line">v505wdu3fxqo        my-tomcat.2         tomcat:latest       manager-node        Running             Running 46 seconds ago                       </span><br><span class="line">wpbsilp62sc0        my-tomcat.3         tomcat:latest       worker02-node       Running             Running 49 seconds ago  </span><br></pre></td></tr></table></figure>

<p>此时到worker01-node上：docker ps，可以发现container的name和service名称不一样，这点要知道</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">bc4b9bb097b8        tomcat:latest       &quot;catalina.sh run&quot;   10 minutes ago      Up 10 minutes       8080/tcp            my-tomcat.1.u6o4mz4tj3969a1p3mquagxok</span><br></pre></td></tr></table></figure>

<blockquote>
<p>(7)如果某个node上的my-tomcat挂掉了，这时候会自动扩展</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[worker01-node]</span><br><span class="line">docker rm -f containerid</span><br><span class="line"></span><br><span class="line">[manager-node]</span><br><span class="line">docker service ls</span><br><span class="line">docker service ps my-tomcat</span><br></pre></td></tr></table></figure>

<blockquote>
<p>(8)删除service</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker service rm my-tomcat</span><br></pre></td></tr></table></figure>

<h3 id="7-2-2-多机通信overlay网络-3-7的延续"><a href="#7-2-2-多机通信overlay网络-3-7的延续" class="headerlink" title="7.2.2 多机通信overlay网络[3.7的延续]"></a>7.2.2 多机通信overlay网络[3.7的延续]</h3><blockquote>
<p><code>业务场景</code>：workpress+mysql实现个人博客搭建</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://hub.docker.com/_/wordpress?tab=description">https://hub.docker.com/_/wordpress?tab=description</a></p>
</blockquote>
</blockquote>
<h4 id="7-2-2-1-传统手动方式实现"><a href="#7-2-2-1-传统手动方式实现" class="headerlink" title="7.2.2.1 传统手动方式实现"></a>7.2.2.1 传统手动方式实现</h4><h5 id="7-2-2-1-1-一台centos上，分别创建容器"><a href="#7-2-2-1-1-一台centos上，分别创建容器" class="headerlink" title="7.2.2.1.1 一台centos上，分别创建容器"></a>7.2.2.1.1 一台centos上，分别创建容器</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">01-创建mysql容器[创建完成等待一会，注意mysql的版本]</span><br><span class="line">	docker run -d --name mysql -v v1:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=examplepass -e MYSQL_DATABASE=db_wordpress mysql:5.6</span><br><span class="line">	</span><br><span class="line">02-创建wordpress容器[将wordpress的80端口映射到centos的8080端口]</span><br><span class="line">	docker run -d --name wordpress --link mysql -e WORDPRESS_DB_HOST=mysql:3306 -e WORDPRESS_DB_USER=root -e WORDPRESS_DB_PASSWORD=examplepass -e WORDPRESS_DB_NAME=db_wordpress -p 8080:80 wordpress</span><br><span class="line">	</span><br><span class="line">03-查看默认bridge的网络，可以发现两个容器都在其中</span><br><span class="line">	docker network inspect bridge</span><br><span class="line">	</span><br><span class="line">04-访问测试</span><br><span class="line">	win浏览器中输入：ip[centos]:8080，一直下一步</span><br></pre></td></tr></table></figure>

<h5 id="7-2-2-1-2-使用docker-compose创建"><a href="#7-2-2-1-2-使用docker-compose创建" class="headerlink" title="7.2.2.1.2 使用docker compose创建"></a>7.2.2.1.2 使用docker compose创建</h5><blockquote>
<p>docker-compose的方式还是在一台机器中，网络这块很清晰</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">01-创建wordpress-mysql文件夹</span><br><span class="line">	mkdir -p /tmp/wordpress-mysql</span><br><span class="line">	cd /tmp/wordpress-mysql</span><br><span class="line">	</span><br><span class="line">02-创建docker-compose.yml文件</span><br></pre></td></tr></table></figure>

<p><code>文件内容</code></p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.1&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">wordpress:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">wordpress</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">8080</span><span class="string">:80</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">WORDPRESS_DB_HOST:</span> <span class="string">db</span></span><br><span class="line">      <span class="attr">WORDPRESS_DB_USER:</span> <span class="string">exampleuser</span></span><br><span class="line">      <span class="attr">WORDPRESS_DB_PASSWORD:</span> <span class="string">examplepass</span></span><br><span class="line">      <span class="attr">WORDPRESS_DB_NAME:</span> <span class="string">exampledb</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">wordpress:/var/www/html</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">db:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql:5.7</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">MYSQL_DATABASE:</span> <span class="string">exampledb</span></span><br><span class="line">      <span class="attr">MYSQL_USER:</span> <span class="string">exampleuser</span></span><br><span class="line">      <span class="attr">MYSQL_PASSWORD:</span> <span class="string">examplepass</span></span><br><span class="line">      <span class="attr">MYSQL_RANDOM_ROOT_PASSWORD:</span> <span class="string">&#x27;1&#x27;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">db:/var/lib/mysql</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">wordpress:</span></span><br><span class="line">  <span class="attr">db:</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">03-根据docker-compose.yml文件创建service</span><br><span class="line">	docker-compose up -d</span><br><span class="line">	</span><br><span class="line">04-访问测试</span><br><span class="line">	win10浏览器ip[centos]:8080，一直下一步</span><br><span class="line">	</span><br><span class="line">05-值得关注的点是网络</span><br><span class="line">	docker network ls</span><br><span class="line">	docker network inspect wordpress-mysql_default</span><br></pre></td></tr></table></figure>

<h4 id="7-2-2-2-Swarm中实现"><a href="#7-2-2-2-Swarm中实现" class="headerlink" title="7.2.2.2 Swarm中实现"></a>7.2.2.2 Swarm中实现</h4><blockquote>
<p>还是wordpress+mysql的案例，在docker swarm集群中怎么玩呢？</p>
</blockquote>
<blockquote>
<p>(1)创建一个overlay网络，用于docker swarm中多机通信</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">【manager-node】</span><br><span class="line">docker network create -d overlay my-overlay-net</span><br><span class="line"></span><br><span class="line">docker network ls[此时worker node查看不到]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>(2)创建mysql的service</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">【manager-node】</span><br><span class="line">01-创建service</span><br><span class="line">docker service create --name mysql --mount type=volume,source=v1,destination=/var/lib/mysql --env MYSQL_ROOT_PASSWORD=examplepass --env MYSQL_DATABASE=db_wordpress --network my-overlay-net mysql:5.6</span><br><span class="line"></span><br><span class="line">02-查看service</span><br><span class="line">	docker service ls</span><br><span class="line">	docker service ps mysql</span><br></pre></td></tr></table></figure>

<blockquote>
<p>(3)创建wordpress的service</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">01-创建service  [注意之所以下面可以通过mysql名字访问，也是因为有DNS解析]</span><br><span class="line">docker service create --name wordpress --env WORDPRESS_DB_USER=root --env WORDPRESS_DB_PASSWORD=examplepass --env WORDPRESS_DB_HOST=mysql:3306 --env WORDPRESS_DB_NAME=db_wordpress -p 8080:80 --network my-overlay-net wordpress</span><br><span class="line"></span><br><span class="line">02-查看service</span><br><span class="line">	docker service ls</span><br><span class="line">	docker service ps mysql</span><br><span class="line">	</span><br><span class="line">03-此时mysql和wordpress的service运行在哪个node上，这时候就能看到my-overlay-net的网络</span><br></pre></td></tr></table></figure>

<blockquote>
<p>(4)测试</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">win浏览器访问ip[manager/worker01/worker02]:8080都能访问成功</span><br></pre></td></tr></table></figure>

<blockquote>
<p>(5)查看my-overlay-net</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network inspect my-overlay-net</span><br></pre></td></tr></table></figure>

<blockquote>
<p>(6)为什么没有用etcd？docker swarm中有自己的分布式存储机制</p>
</blockquote>
<h2 id="7-3-Routing-Mesh"><a href="#7-3-Routing-Mesh" class="headerlink" title="7.3 Routing Mesh"></a>7.3 Routing Mesh</h2><h3 id="7-3-1-Ingress"><a href="#7-3-1-Ingress" class="headerlink" title="7.3.1 Ingress"></a>7.3.1 Ingress</h3><blockquote>
<p>通过前面的案例我们发现，部署一个wordpress的service，映射到主机的8080端口，这时候通过swarm集群中的任意主机ip:<br>8080都能成功访问，这是因为什么？</p>
<p><code>把问题简化</code>：docker service create –name tomcat -p 8080:8080 –network my-overlay-net tomcat</p>
</blockquote>
<blockquote>
<p>(1)记得使用一个自定义的overlay类型的网络</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--network my-overlay-net</span><br></pre></td></tr></table></figure>

<blockquote>
<p>(2)查看service情况</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker service ls</span><br><span class="line">docker service ps tomcat</span><br></pre></td></tr></table></figure>

<blockquote>
<p>(3)访问3台机器的ip:8080测试</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">发现都能够访问到tomcat的欢迎页</span><br></pre></td></tr></table></figure>

<h3 id="7-4-2-Internal"><a href="#7-4-2-Internal" class="headerlink" title="7.4.2 Internal"></a>7.4.2 Internal</h3><blockquote>
<p>之前在实战wordpress+mysql的时候，发现wordpress中可以直接通过mysql名称访问</p>
<p>这样可以说明两点，第一是其中一定有dns解析，第二是两个service的ip是能够ping通的</p>
<p><code>思考</code>：不妨再创建一个service，也同样使用上述tomcat的overlay网络，然后来实验</p>
<p>docker service create –name whoami -p 8000:8000 –network my-overlay-net -d jwilder&#x2F;whoami</p>
</blockquote>
<blockquote>
<p>(1)查看whoami的情况</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker service ps whoami</span><br></pre></td></tr></table></figure>

<blockquote>
<p>(2)在各自容器中互相ping一下彼此，也就是容器间的通信</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#tomcat容器中ping whoami</span><br><span class="line">docker exec -it 9d7d4c2b1b80 ping whoami</span><br><span class="line">64 bytes from bogon (10.0.0.8): icmp_seq=1 ttl=64 time=0.050 ms</span><br><span class="line">64 bytes from bogon (10.0.0.8): icmp_seq=2 ttl=64 time=0.080 ms</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#whoami容器中ping tomcat</span><br><span class="line">docker exec -it 5c4fe39e7f60 ping tomcat</span><br><span class="line">64 bytes from bogon (10.0.0.18): icmp_seq=1 ttl=64 time=0.050 ms</span><br><span class="line">64 bytes from bogon (10.0.0.18): icmp_seq=2 ttl=64 time=0.080 ms</span><br></pre></td></tr></table></figure>

<blockquote>
<p>(3)将whoami进行扩容</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker service scale whoami=3</span><br><span class="line">docker service ps whoami     #manager,worker01,worker02</span><br></pre></td></tr></table></figure>

<blockquote>
<p>(4)此时再ping whoami service，并且访问whoami服务</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#ping</span><br><span class="line">docker exec -it 9d7d4c2b1b80 ping whoami</span><br><span class="line">64 bytes from bogon (10.0.0.8): icmp_seq=1 ttl=64 time=0.055 ms</span><br><span class="line">64 bytes from bogon (10.0.0.8): icmp_seq=2 ttl=64 time=0.084 ms</span><br><span class="line"></span><br><span class="line">#访问</span><br><span class="line">docker exec -it 9d7d4c2b1b80 curl whoami:8000  [多访问几次]</span><br><span class="line">I&#x27;m 09f4158c81ae</span><br><span class="line">I&#x27;m aebc574dc990</span><br><span class="line">I&#x27;m 7755bc7da921</span><br></pre></td></tr></table></figure>

<p><code>小结</code>：通过上述的实验可以发现什么？whoami服务对其他服务暴露的ip是不变的，但是通过whoami名称访问8000端口，确实访问到的是不同的service，就说明访问其实是像下面这张图。</p>
<p>也就是说whoami service对其他服务提供了一个统一的VIP入口，别的服务访问时会做负载均衡。</p>
<h2 id="7-5-Stack"><a href="#7-5-Stack" class="headerlink" title="7.5 Stack"></a>7.5 Stack</h2><blockquote>
<p>docker stack deploy：<a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/stack_deploy/">https://docs.docker.com/engine/reference/commandline/stack_deploy/</a></p>
<p>compose-file：<a target="_blank" rel="noopener" href="https://docs.docker.com/compose/compose-file/">https://docs.docker.com/compose/compose-file/</a></p>
<p>有没有发现上述部署service很麻烦？要是能够类似于docker-compose.yml文件那种方式一起管理该多少？这就要涉及到docker<br>swarm中的Stack，我们直接通过前面的wordpress+mysql案例看看怎么使用咯。</p>
</blockquote>
<blockquote>
<p>(1)新建service.yml文件</p>
</blockquote>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">wordpress:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">wordpress</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">8080</span><span class="string">:80</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">WORDPRESS_DB_HOST:</span> <span class="string">db</span></span><br><span class="line">      <span class="attr">WORDPRESS_DB_USER:</span> <span class="string">exampleuser</span></span><br><span class="line">      <span class="attr">WORDPRESS_DB_PASSWORD:</span> <span class="string">examplepass</span></span><br><span class="line">      <span class="attr">WORDPRESS_DB_NAME:</span> <span class="string">exampledb</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ol-net</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">wordpress:/var/www/html</span></span><br><span class="line">    <span class="attr">deploy:</span></span><br><span class="line">      <span class="attr">mode:</span> <span class="string">replicated</span></span><br><span class="line">      <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">      <span class="attr">restart_policy:</span></span><br><span class="line">        <span class="attr">condition:</span> <span class="string">on-failure</span></span><br><span class="line">        <span class="attr">delay:</span> <span class="string">5s</span></span><br><span class="line">        <span class="attr">max_attempts:</span> <span class="number">3</span></span><br><span class="line">      <span class="attr">update_config:</span></span><br><span class="line">        <span class="attr">parallelism:</span> <span class="number">1</span></span><br><span class="line">        <span class="attr">delay:</span> <span class="string">10s</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">db:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql:5.7</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">MYSQL_DATABASE:</span> <span class="string">exampledb</span></span><br><span class="line">      <span class="attr">MYSQL_USER:</span> <span class="string">exampleuser</span></span><br><span class="line">      <span class="attr">MYSQL_PASSWORD:</span> <span class="string">examplepass</span></span><br><span class="line">      <span class="attr">MYSQL_RANDOM_ROOT_PASSWORD:</span> <span class="string">&#x27;1&#x27;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">db:/var/lib/mysql</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ol-net</span></span><br><span class="line">    <span class="attr">deploy:</span></span><br><span class="line">      <span class="attr">mode:</span> <span class="string">global</span></span><br><span class="line">      <span class="attr">placement:</span></span><br><span class="line">        <span class="attr">constraints:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">node.role</span> <span class="string">==</span> <span class="string">manager</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">wordpress:</span></span><br><span class="line">  <span class="attr">db:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">ol-net:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">overlay</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>(2)根据service.yml创建service</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker statck deploy -c service.yml my-service</span><br></pre></td></tr></table></figure>

<blockquote>
<p>(3)常见操作</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">01-查看stack具体信息</span><br><span class="line">	docker stack ls</span><br><span class="line">	NAME                SERVICES            ORCHESTRATOR</span><br><span class="line">	my-service          2                   Swarm</span><br><span class="line">	</span><br><span class="line">02-查看具体的service</span><br><span class="line">	docker stack services my-service</span><br><span class="line">	</span><br><span class="line">ID                  NAME                   MODE                REPLICAS            IMAGE               PORTS</span><br><span class="line">icraimlesu61        my-service_db          global              1/1                 mysql:5.7           </span><br><span class="line">iud2g140za5c        my-service_wordpress   replicated          3/3                 wordpress:latest    *:8080-&gt;80/tcp</span><br><span class="line"></span><br><span class="line">03-查看某个service</span><br><span class="line">	docker service inspect my-service-db</span><br><span class="line">	</span><br><span class="line">&quot;Endpoint&quot;: &#123;</span><br><span class="line">            &quot;Spec&quot;: &#123;</span><br><span class="line">                &quot;Mode&quot;: &quot;vip&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;VirtualIPs&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;NetworkID&quot;: &quot;kz1reu3yxxpwp1lvnrraw0uq6&quot;,</span><br><span class="line">                    &quot;Addr&quot;: &quot;10.0.1.5/24&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>(4)访问测试</p>
</blockquote>
<p>win浏览器ip[manager,worker01,worker02]:8080</p>
            


        </div>
    </div>
    <br/>
    <!-- 添加的部分 -->
    <!-- copyright -->
    
        <style>
.article-footer-copyright {
	border-left-color: #f66;
	padding: 12px 24px 12px 30px;
    margin: 2em 0;
    border-left-width: 4px;
    border-left-style: solid;
    background-color: #f8f8f8;
    position: relative;
    border-bottom-right-radius: 2px;
    border-top-right-radius: 2px;
	margin:0 auto;
	max-width: 850px;}
</style>
<div class="article-footer-copyright">
    <!-- <span>本文标题:</span><href="/%20"> 五、(Docker系列)Docker深度提升篇笔记</a><br/> -->
    <!-- <span>文章作者:</span><a href="/" title="访问 Mr.WangLi的个人博客">Mr.WangLi</a><br/> -->
	<span>版权归属:</span><a href="/" title="访问 Mr.WangLi的个人博客">Mr.WangLi</a><br/>
    <span>发布时间:</span>2019年11月23日 - 11:38 | 
    <span>最后更新:</span>2024年09月01日 - 21:22<br/>
    <span>原始链接:</span><a href="/posts/525c4592.html" title="五、(Docker系列)Docker深度提升篇笔记">https://blog.biwin.eu.org/posts/525c4592.html</a><br/>
    <span class="copy-path" title="点击复制文章链接"><i class="fa fa-clipboard" data-clipboard-text="https://blog.biwin.eu.org/posts/525c4592.html"  aria-label="复制成功！"></i></span><br/>
    <span>许可协议:</span><i class="fab fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">知识共享署名4.0 国际许可协议</a> 转载请保留原文链接及作者。
</div>

    
    <!-- copyright -->
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">标签</span><br/>
                
    <a class="tag tag--primary tag--small t-none-link" href="/tags/docker/" rel="tag">docker</a>

            </div>
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/posts/a95bfc2e.html"
                    data-tooltip="docker工具箱命令集-问题集锦"
                    aria-label="上一篇: docker工具箱命令集-问题集锦"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">上一篇</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/posts/a2fc68e9.html"
                    data-tooltip="三、(Docker系列)Docker精髓剖析-网络"
                    aria-label="下一篇: 三、(Docker系列)Docker精髓剖析-网络"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">下一篇</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Diesen Beitrag teilen"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="http://service.weibo.com/share/share.php?&amp;title=https://blog.biwin.eu.org/posts/525c4592.html"
                    title="分享到 Weibo"
                    aria-label="分享到 Weibo"
                >
                    <i class="fab fa-weibo" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.biwin.eu.org/posts/525c4592.html&amp;title=五、(Docker系列)Docker深度提升篇笔记"
                    title="分享到 QQ"
                    aria-label="分享到 QQ"
                >
                    <i class="fab fa-qq" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https://blog.biwin.eu.org/posts/525c4592.html"
                    title="分享到 Qzone"
                    aria-label="分享到 Qzone"
                >
                    <i class="fa fa-star" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#table-of-contents" aria-label="目录">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
                <br/>
<div class="vcomment"></div>
            
        
    </div>
</article>




                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2024 Mr.WangLi. All Rights Reserved.
    </span>
    <br/>
    
        <!-- 不蒜子统计 -->
        <span id="busuanzi_container_site_pv">
	                本站总访问量<span id="busuanzi_value_site_pv"></span>次
	        </span>
        <span class="post-meta-divider">|</span>
        <span id="busuanzi_container_site_uv" style='display:none'>
	                本站访客数<span id="busuanzi_value_site_uv"></span>人
	        </span>
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/posts/a95bfc2e.html"
                    data-tooltip="docker工具箱命令集-问题集锦"
                    aria-label="上一篇: docker工具箱命令集-问题集锦"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">上一篇</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/posts/a2fc68e9.html"
                    data-tooltip="三、(Docker系列)Docker精髓剖析-网络"
                    aria-label="下一篇: 三、(Docker系列)Docker精髓剖析-网络"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">下一篇</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Diesen Beitrag teilen"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="http://service.weibo.com/share/share.php?&amp;title=https://blog.biwin.eu.org/posts/525c4592.html"
                    title="分享到 Weibo"
                    aria-label="分享到 Weibo"
                >
                    <i class="fab fa-weibo" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.biwin.eu.org/posts/525c4592.html&amp;title=五、(Docker系列)Docker深度提升篇笔记"
                    title="分享到 QQ"
                    aria-label="分享到 QQ"
                >
                    <i class="fab fa-qq" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https://blog.biwin.eu.org/posts/525c4592.html"
                    title="分享到 Qzone"
                    aria-label="分享到 Qzone"
                >
                    <i class="fa fa-star" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#table-of-contents" aria-label="目录">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                
    <div id="share-options-bar" class="share-options-bar" data-behavior="4">
        <i id="btn-close-shareoptions" class="fa fa-times"></i>
        <ul class="share-options">
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="http://service.weibo.com/share/share.php?&amp;title=https://blog.biwin.eu.org/posts/525c4592.html"
                        aria-label="分享到 Weibo"
                    >
                        <i class="fab fa-weibo" aria-hidden="true"></i><span>分享到 Weibo</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.biwin.eu.org/posts/525c4592.html&amp;title=五、(Docker系列)Docker深度提升篇笔记"
                        aria-label="分享到 QQ"
                    >
                        <i class="fab fa-qq" aria-hidden="true"></i><span>分享到 QQ</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https://blog.biwin.eu.org/posts/525c4592.html"
                        aria-label="分享到 Qzone"
                    >
                        <i class="fa fa-star" aria-hidden="true"></i><span>分享到 Qzone</span>
                    </a>
                </li>
            
        </ul>
    </div>


            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="https://img.biwin.eu.org/touxiang.jpeg" alt="作者的图片"/>
        
            <h4 id="about-card-name">Mr.WangLi</h4>
        
            <div id="about-card-bio"><p>喜欢技术，喜欢一个人！</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>一个有脾气的 Javaer</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker-alt"></i>
                <br/>
                中国·四川·成都
            </div>
        
    </div>
</div>

        
            <div id="algolia-search-modal" class="modal-container">
    <div class="modal">
        <div class="modal-header">
            <span class="close-button"><i class="fa fa-times"></i></span>
            <a href="https://algolia.com" target="_blank" rel="noopener" class="searchby-algolia text-color-light link-unstyled">
                <span class="searchby-algolia-text text-color-light text-small">by</span>
                <img class="searchby-algolia-logo" src="/assets/images/logo-algolia-nebula-blue-full.svg">
            </a>
            <i class="search-icon fa fa-search"></i>
            <form id="algolia-search-form">
                <input type="text" id="algolia-search-input" name="search"
                    class="form-control input--large search-input" placeholder="Search "
                    />
            </form>
        </div>
        <div class="modal-body">
            <div class="no-result text-color-light text-center">没有找到文章</div>
            <div class="results">
                
                <div class="media">
                    
                    <div class="media-left">
                        <a
                            class="link-unstyled"
                            href="https://blog.biwin.eu.org/posts/e800f027.html"
                            aria-label=": Java8新特性之Lambda表达式"
                        >
                            <img class="media-image" src="https://api.dujin.org/bing/1366.php" width="90" height="90"/>
                        </a>
                    </div>
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://blog.biwin.eu.org/posts/e800f027.html"
                            aria-label=": Java8新特性之Lambda表达式"
                        >
                            <h3 class="media-heading">Java8新特性之Lambda表达式</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2018年6月19日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>lambda表达式是java8给我们带来的几个重量级新特性之一，借用lambda表达式，可以让我们的java程序设计更加简洁。最近新的项目摒弃了1.6的版本，全面基于java8进行开发，本篇文章是java8新特性的第一篇，将探讨行为参数化、lambda表达式，以及方法引用。</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-left">
                        <a
                            class="link-unstyled"
                            href="https://blog.biwin.eu.org/posts/e19f5dc7.html"
                            aria-label=": Java8新特性之Optional类"
                        >
                            <img class="media-image" src="https://api.dujin.org/bing/1366.php" width="90" height="90"/>
                        </a>
                    </div>
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://blog.biwin.eu.org/posts/e19f5dc7.html"
                            aria-label=": Java8新特性之Optional类"
                        >
                            <h3 class="media-heading">Java8新特性之Optional类</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2018年6月19日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>Optional不是对null关键字的一种替代，而是对于null判定提供了一种更加优雅的实现</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-left">
                        <a
                            class="link-unstyled"
                            href="https://blog.biwin.eu.org/posts/df816e2e.html"
                            aria-label=": Java8新特性之流式数据处理"
                        >
                            <img class="media-image" src="https://api.dujin.org/bing/1366.php" width="90" height="90"/>
                        </a>
                    </div>
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://blog.biwin.eu.org/posts/df816e2e.html"
                            aria-label=": Java8新特性之流式数据处理"
                        >
                            <h3 class="media-heading">Java8新特性之流式数据处理</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2018年6月20日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>java8的流式处理极大了简化我们对于集合、数组等结构的操作，让我们可以以函数式的思想去操作，本篇文章将探讨java8的流式数据处理的基本使用。</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-left">
                        <a
                            class="link-unstyled"
                            href="https://blog.biwin.eu.org/posts/4e2dcaec.html"
                            aria-label=": Java8新特性之默认接口方法"
                        >
                            <img class="media-image" src="https://api.dujin.org/bing/1366.php" width="90" height="90"/>
                        </a>
                    </div>
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://blog.biwin.eu.org/posts/4e2dcaec.html"
                            aria-label=": Java8新特性之默认接口方法"
                        >
                            <h3 class="media-heading">Java8新特性之默认接口方法</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2018年6月21日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>从java8开始，接口不只是一个只能声明方法的地方，我们还可以在声明方法时，给方法一个默认的实现，我们称之为默认接口方法，这样所有实现该接口的子类都可以持有该方法的默认实现。</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-left">
                        <a
                            class="link-unstyled"
                            href="https://blog.biwin.eu.org/posts/f5f90d4.html"
                            aria-label=": 一、(Docker系列)初识Docker，搭建本地环境"
                        >
                            <img class="media-image" src="https://5b868fd.webp.li/docker-conver.png" width="90" height="90"/>
                        </a>
                    </div>
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://blog.biwin.eu.org/posts/f5f90d4.html"
                            aria-label=": 一、(Docker系列)初识Docker，搭建本地环境"
                        >
                            <h3 class="media-heading">一、(Docker系列)初识Docker，搭建本地环境</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2019年11月5日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>学习搭建Docker环境，结合{ % post_link docker工具箱命令集-问题集锦 % }食用，效果佳</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-left">
                        <a
                            class="link-unstyled"
                            href="https://blog.biwin.eu.org/posts/1d2e50aa.html"
                            aria-label=": 二、(Docker系列)Docker灵魂探讨"
                        >
                            <img class="media-image" src="https://5b868fd.webp.li/docker-conver.png" width="90" height="90"/>
                        </a>
                    </div>
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://blog.biwin.eu.org/posts/1d2e50aa.html"
                            aria-label=": 二、(Docker系列)Docker灵魂探讨"
                        >
                            <h3 class="media-heading">二、(Docker系列)Docker灵魂探讨</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2019年11月6日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>深入学习Image和Container</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-left">
                        <a
                            class="link-unstyled"
                            href="https://blog.biwin.eu.org/posts/a2fc68e9.html"
                            aria-label=": 三、(Docker系列)Docker精髓剖析-网络"
                        >
                            <img class="media-image" src="https://5b868fd.webp.li/docker-conver.png" width="90" height="90"/>
                        </a>
                    </div>
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://blog.biwin.eu.org/posts/a2fc68e9.html"
                            aria-label=": 三、(Docker系列)Docker精髓剖析-网络"
                        >
                            <h3 class="media-heading">三、(Docker系列)Docker精髓剖析-网络</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2019年11月15日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>Docker和Linux中的网络深入</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-left">
                        <a
                            class="link-unstyled"
                            href="https://blog.biwin.eu.org/posts/525c4592.html"
                            aria-label=": 五、(Docker系列)Docker深度提升篇笔记"
                        >
                            <img class="media-image" src="https://5b868fd.webp.li/docker-conver.png" width="90" height="90"/>
                        </a>
                    </div>
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://blog.biwin.eu.org/posts/525c4592.html"
                            aria-label=": 五、(Docker系列)Docker深度提升篇笔记"
                        >
                            <h3 class="media-heading">五、(Docker系列)Docker深度提升篇笔记</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2019年11月23日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>Docker Compose与Docker Swarm</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-left">
                        <a
                            class="link-unstyled"
                            href="https://blog.biwin.eu.org/posts/a95bfc2e.html"
                            aria-label=": docker工具箱命令集-问题集锦"
                        >
                            <img class="media-image" src="https://5b868fd.webp.li/docker-conver.png" width="90" height="90"/>
                        </a>
                    </div>
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://blog.biwin.eu.org/posts/a95bfc2e.html"
                            aria-label=": docker工具箱命令集-问题集锦"
                        >
                            <h3 class="media-heading">docker工具箱命令集-问题集锦</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2019年11月23日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>Vagrant Docker 命令集解释备忘</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-left">
                        <a
                            class="link-unstyled"
                            href="https://blog.biwin.eu.org/posts/8d02a8ee.html"
                            aria-label=": 四、(Docker系列)Docker项目实战"
                        >
                            <img class="media-image" src="https://5b868fd.webp.li/docker-conver.png" width="90" height="90"/>
                        </a>
                    </div>
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://blog.biwin.eu.org/posts/8d02a8ee.html"
                            aria-label=": 四、(Docker系列)Docker项目实战"
                        >
                            <h3 class="media-heading">四、(Docker系列)Docker项目实战</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2019年12月13日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>Docker中的Volume</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
            </div>
        </div>
        <div class="modal-footer">
            <p class="results-count text-medium"
                data-message-zero="没有找到文章"
                data-message-one="找到 1 篇文章"
                data-message-other="找到 {n} 篇文章">
                找到 16 篇文章
            </p>
        </div>
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/script-2ilv1quqkw94scdhy4pnuktwociarglt6w05ucfykbnexqz9mfxy2dvfhgcl.min.js"></script>

<!--SCRIPTS END-->


    
        
<script src="https://cdn.jsdelivr.net/npm/valine@1.3.10/dist/Valine.min.js"></script>

        <script>
            new Valine({
                el: '.vcomment',
                notify: false,
                verify: false,
                appId: "6Im09hBEDOiBEU45f3fOc9Hm-gzGzoHsz",
                appKey: "Tc4aa3tRDVWw4GJEcBNfaAuB",
                placeholder: "发现问题，讨论问题，反馈问题，欢迎您的留言和评论！",
                pageSize:'10',
                avatar:'monsterid',
                meta: ['nick', 'mail'],
                lang:''
            })
        </script>
    



    
<script src="/assets/js/moment-with-locales.js"></script>

    
<script src="/assets/js/algoliasearch.js"></script>

    <script>
        var algoliaClient = algoliasearch('I16OUI732Q', 'e1b3e94dd16c5fd972a4f855178f99f8');
        var algoliaIndex = algoliaClient.initIndex('blog');
    </script>


    </body>
</html>
