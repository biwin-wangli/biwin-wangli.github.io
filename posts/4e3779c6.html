
<!DOCTYPE html>
<html lang="zh-cn">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="BiWin&#39;s Blog">
    <title>HashMap为什么线程不安全 - BiWin&#39;s Blog</title>
    <meta name="author" content="Mr.WangLi">
    
        <meta name="keywords" content="Hexo,javascript,java,docker,kubernetes,jvm,mysql,nodejs,vue,mybatis,HashMap">
    
    
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Mr.WangLi","sameAs":["https://github.com/biwin-wangli","http://stackoverflow.com/users","https://www.linkedin.com/profile/","mailto:274027703@qq.com"],"image":"https://img.biwin.eu.org/touxiang.jpeg"},"articleBody":"\n\n\nJdk1.7中的HashMap在jdk1.8中对HashMap做了很多优化，这里先分析在jdk1.7中的问题，相信大家都知道在jdk1.7多线程环境下HashMap容易出现死循环，这里我们先用代码来模拟出现死循环的情况：\n123456789101112131415161718192021222324252627public class HashMapTest &#123;    public static void main(String[] args) &#123;        HashMapThread thread0 = new HashMapThread();        HashMapThread thread1 = new HashMapThread();        HashMapThread thread2 = new HashMapThread();        HashMapThread thread3 = new HashMapThread();        HashMapThread thread4 = new HashMapThread();        thread0.start();        thread1.start();        thread2.start();        thread3.start();        thread4.start();    &#125;&#125;class HashMapThread extends Thread &#123;    private static AtomicInteger ai = new AtomicInteger();    private static Map&lt;Integer, Integer&gt; map = new HashMap&lt;&gt;();    @Override    public void run() &#123;        while (ai.get() &lt; 1000000) &#123;            map.put(ai.get(), ai.get());            System.out.println(ai.incrementAndGet());        &#125;    &#125;&#125;\n上述代码比较简单，就是开多个线程不断进行put操作，并且HashMap与AtomicInteger都是全局共享的。在多运行几次该代码后，出现如下死循环情形：其中有几次还会出现数组越界的情况：\n这里我们着重分析为什么会出现死循环的情况，通过jps和jstack命名查看死循环情况，结果如下：\n从堆栈信息中可以看到出现死循环的位置，通过该信息可明确知道死循环发生在HashMap的扩容函数中，根源在transfer函数中，jdk1.7中HashMap的transfer函数如下：\n123456789101112131415void transfer(Entry[] newTable, boolean rehash) &#123;        int newCapacity = newTable.length;        for (Entry&lt;K,V&gt; e : table) &#123;            while(null != e) &#123;                Entry&lt;K,V&gt; next = e.next;                if (rehash) &#123;                    e.hash = null == e.key ? 0 : hash(e.key);                &#125;                int i = indexFor(e.hash, newCapacity);                e.next = newTable[i];                newTable[i] = e;                e = next;            &#125;        &#125;&#125;\n总结下该函数的主要作用：在对table进行扩容到newTable后，需要将原来数据转移到newTable中，注意10-12行代码，这里可以看出在转移元素的过程中，使用的是头插法，也就是链表的顺序会翻转，这里也是形成死循环的关键点。\n下面进行详细分析。\n1.1 扩容造成死循环分析过程前提条件，这里假设：\n\nhash算法为简单的用key mod链表的大小。\n最开始hash表size&#x3D;2，key&#x3D;3,7,5，则都在table[1]中。\n然后进行resize，使size变成4。\n\n未resize前的数据结构如下：\n如果在单线程环境下，最后的结果如下：\n这里的转移过程，不再进行详述，只要理解transfer函数在做什么，其转移过程以及如何对链表进行反转应该不难。\n然后在多线程环境下，假设有两个线程A和B都在进行put操作。线程A在执行到transfer函数中第11行代码处挂起，因为该函数在这里分析的地位非常重要，因此再次贴出来。\n123456789101112131415161718/** * Transfers all entries from current table to newTable. */void transfer(Entry[] newTable, boolean rehash) &#123;    int newCapacity = newTable.length;    for (Entry&lt;K,V&gt; e : table) &#123;        while(null != e) &#123;            Entry&lt;K,V&gt; next = e.next;            if (rehash) &#123;                e.hash = null == e.key ? 0 : hash(e.key);            &#125;            int i = indexFor(e.hash, newCapacity);            e.next = newTable[i];            newTable[i] = e; // 线程A在这里挂起            e = next;        &#125;    &#125;&#125;\n\n此时线程A中运行结果如下：线程A挂起后，此时线程B正常执行，并完成resize操作，结果如下：\n这里需要特别注意的点：由于线程B已经执行完毕，根据Java内存模型，现在newTable和table中的Entry都是主存中最新值：7.next&#x3D;3，3.next&#x3D;null。\n此时切换到线程A上，在线程A挂起时内存中值如下：e&#x3D;3，next&#x3D;7，newTable[3]&#x3D;null，代码执行过程如下：\n12newTable[3]=e ----&gt; newTable[3]=3e=next ----&gt; e=7\n\n此时结果如下：继续循环：\n12345e=7next=e.next ----&gt; next=3【从主存中取值】e.next=newTable[3] ----&gt; e.next=3【从主存中取值】newTable[3]=e ----&gt; newTable[3]=7e=next ----&gt; e=3\n再次进行循环：\n12345e=3next=e.next ----&gt; next=nulle.next=newTable[3] ----&gt; e.next=7 即：3.next=7newTable[3]=e ----&gt; newTable[3]=3e=next ----&gt; e=null\n注意此次循环：e.next&#x3D;7，而在上次循环中7.next&#x3D;3，出现环形链表，并且此时e&#x3D;null循环结束。结果如下：在后续操作中只要涉及轮询HashMap的数据结构，就会在这里发生死循环，造成悲剧。面试必问的：{ % post_link 几种线程安全的Map解析 % }，推荐大家看下。\n扩容造成数据丢失分析过程遵照上述分析过程，初始时：线程A和线程B进行put操作，同样线程A挂起：\n123456789101112131415161718/** * Transfers all entries from current table to newTable. */void transfer(Entry[] newTable, boolean rehash) &#123;    int newCapacity = newTable.length;    for (Entry&lt;K,V&gt; e : table) &#123;        while(null != e) &#123;            Entry&lt;K,V&gt; next = e.next;            if (rehash) &#123;                e.hash = null == e.key ? 0 : hash(e.key);            &#125;            int i = indexFor(e.hash, newCapacity);            e.next = newTable[i];            newTable[i] = e; // 线程A在这里挂起            e = next;        &#125;    &#125;&#125;\n此时线程A的运行结果如下：此时线程B已获得CPU时间片，并完成resize操作：\n同样注意由于线程B执行完成，newTable和table都为最新值：5.next&#x3D;null。此时切换到线程A，在线程A挂起时：e&#x3D;7，next&#x3D;5，newTable[3]&#x3D;null。执行newtable[i]&#x3D;e，就将7放在了table[3]的位置，此时next&#x3D;5。接着进行下一次循环：\n12345e=5next=e.next ----&gt; next=null，从主存中取值e.next=newTable[1] ----&gt; e.next=5，从主存中取值newTable[1]=e ----&gt; newTable[1]=5e=next ----&gt; e=null\n将5放置在table[1]位置，此时e&#x3D;null循环结束，3元素丢失，并形成环形链表。并在后续操作HashMap时造成死循环。\nJdk1.8中的HashMap在jdk1.8中对HashMap进行了优化，在发生hash碰撞，不再采用头插法方式，而是直接插入链表尾部，因此不会出现环形链表的情况，但是在多线程的情况下仍然不安全。\n这里我们看jdk1.8中HashMap的put操作源码：\n123456789101112131415161718192021222324252627282930313233343536373839404142final V putVal(int hash, K key, V value, boolean onlyIfAbsent,                   boolean evict) &#123;        Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; int n, i;        if ((tab = table) == null || (n = tab.length) == 0)            n = (tab = resize()).length;        if ((p = tab[i = (n - 1) &amp; hash]) == null) // 如果没有hash碰撞则直接插入元素            tab[i] = newNode(hash, key, value, null);        else &#123;            Node&lt;K,V&gt; e; K k;            if (p.hash == hash &amp;&amp;                ((k = p.key) == key || (key != null &amp;&amp; key.equals(k))))                e = p;            else if (p instanceof TreeNode)                e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(this, tab, hash, key, value);            else &#123;                for (int binCount = 0; ; ++binCount) &#123;                    if ((e = p.next) == null) &#123;                        p.next = newNode(hash, key, value, null);                        if (binCount &gt;= TREEIFY_THRESHOLD - 1) // -1 for 1st                            treeifyBin(tab, hash);                        break;                    &#125;                    if (e.hash == hash &amp;&amp;                        ((k = e.key) == key || (key != null &amp;&amp; key.equals(k))))                        break;                    p = e;                &#125;            &#125;            if (e != null) &#123; // existing mapping for key                V oldValue = e.value;                if (!onlyIfAbsent || oldValue == null)                    e.value = value;                afterNodeAccess(e);                return oldValue;            &#125;        &#125;        ++modCount;        if (++size &gt; threshold)            resize();        afterNodeInsertion(evict);        return null;&#125;\n这是jdk1.8中HashMap中put操作的主函数， 注意第6行代码，如果没有hash碰撞则会直接插入元素。\n如果线程A和线程B同时进行put操作，刚好这两条不同的数据hash值一样，并且该位置数据为null，所以这线程A、B都会进入第6行代码中。\n假设一种情况，线程A进入后还未进行数据插入时挂起，而线程B正常执行，从而正常插入数据，然后线程A获取CPU时间片，此时线程A不用再进行hash判断了，问题出现：线程A会把线程B插入的数据给覆盖，发生线程不安全。\n总结首先HashMap是线程不安全的，其主要体现：\n\n在jdk1.7中，在多线程环境下，扩容时会造成环形链或数据丢失。\n在jdk1.8中，在多线程环境下，会发生数据覆盖的情况。\n","dateCreated":"2019-12-16T14:58:20+08:00","dateModified":"2024-09-01T21:22:47+08:00","datePublished":"2019-12-16T14:58:20+08:00","description":"我们都知道HashMap是线程不安全的，在多线程环境中不建议使用，但是其线程不安全主要体现在什么地方呢？","headline":"HashMap为什么线程不安全","image":["https://5b868fd.webp.li/hashmapUnsafe-cover.png","http://pic.tsmp4.net/api/fengjing/img.php"],"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.biwin.eu.org/posts/4e3779c6.html"},"publisher":{"@type":"Organization","name":"Mr.WangLi","sameAs":["https://github.com/biwin-wangli","http://stackoverflow.com/users","https://www.linkedin.com/profile/","mailto:274027703@qq.com"],"image":"https://img.biwin.eu.org/touxiang.jpeg","logo":{"@type":"ImageObject","url":"https://img.biwin.eu.org/touxiang.jpeg"}},"url":"https://blog.biwin.eu.org/posts/4e3779c6.html","keywords":"JDK8","thumbnailUrl":"https://5b868fd.webp.li/hashmapUnsafe-cover.png"}</script>
    <meta name="description" content="HashMap为什么线程不安全">
<meta property="og:type" content="blog">
<meta property="og:title" content="HashMap为什么线程不安全">
<meta property="og:url" content="https://blog.biwin.eu.org/posts/4e3779c6.html">
<meta property="og:site_name" content="BiWin&#39;s Blog">
<meta property="og:description" content="HashMap为什么线程不安全">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://5b868fd.webp.li/hashmapUnsafe-1.png">
<meta property="og:image" content="https://5b868fd.webp.li/hashmapUnsafe-2.png">
<meta property="og:image" content="https://5b868fd.webp.li/hashmapUnsafe-3.png">
<meta property="og:image" content="https://5b868fd.webp.li/hashmapUnsafe-4.png">
<meta property="og:image" content="https://5b868fd.webp.li/hashmapUnsafe-5.png">
<meta property="og:image" content="https://5b868fd.webp.li/hashmapUnsafe-6.png">
<meta property="og:image" content="https://5b868fd.webp.li/hashmapUnsafe-7.png">
<meta property="og:image" content="https://5b868fd.webp.li/hashmapUnsafe-8.png">
<meta property="og:image" content="https://5b868fd.webp.li/hashmapUnsafe-9.png">
<meta property="og:image" content="https://5b868fd.webp.li/hashmapUnsafe-10.png">
<meta property="og:image" content="https://5b868fd.webp.li/hashmapUnsafe-11.png">
<meta property="og:image" content="https://5b868fd.webp.li/hashmapUnsafe-12.png">
<meta property="og:image" content="https://5b868fd.webp.li/hashmapUnsafe-13.png">
<meta property="og:image" content="https://5b868fd.webp.li/hashmapUnsafe-14.png">
<meta property="og:image" content="https://5b868fd.webp.li/hashmapUnsafe-15.png">
<meta property="article:published_time" content="2019-12-16T06:58:20.000Z">
<meta property="article:modified_time" content="2024-09-01T13:22:47.003Z">
<meta property="article:author" content="Mr.WangLi">
<meta property="article:tag" content="JDK8">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://5b868fd.webp.li/hashmapUnsafe-1.png">
    
    
        
    
    
        <meta property="og:image" content="https://img.biwin.eu.org/touxiang.jpeg"/>
    
    
        <meta property="og:image" content="https://5b868fd.webp.li/hashmapUnsafe-cover.png"/>
        <meta class="swiftype" name="image" data-type="enum" content="https://5b868fd.webp.li/hashmapUnsafe-cover.png"/>
    
    
        <meta property="og:image" content="http://pic.tsmp4.net/api/fengjing/img.php"/>
        <meta class="swiftype" name="image" data-type="enum" content="http://pic.tsmp4.net/api/fengjing/img.php"/>
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/style-vfgvchqkdym9obx7tmwvvzqxiypypaaj66luf6y7bb4kfhuqzb8eonjh8v3p.min.css">

    <!--STYLES END-->
    

    

    
        
    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="4">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/"
            aria-label=""
        >
            BiWin&#39;s Blog
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="打开链接: /#about"
            >
        
        
            <img class="header-picture" src="https://img.biwin.eu.org/touxiang.jpeg" alt="作者的图片"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="4">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a
                    href="/#about"
                    aria-label="阅读有关作者的更多信息"
                >
                    <img class="sidebar-profile-picture" src="https://img.biwin.eu.org/touxiang.jpeg" alt="作者的图片"/>
                </a>
                <h4 class="sidebar-profile-name">Mr.WangLi</h4>
                
                    <h5 class="sidebar-profile-bio"><p>喜欢技术，喜欢一个人！</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="首页"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">首页</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-categories"
                            
                            rel="noopener"
                            title="分类"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">分类</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="标签"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">标签</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-archives"
                            
                            rel="noopener"
                            title="归档"
                        >
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">归档</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link open-algolia-search"
                            href="#search"
                            
                            rel="noopener"
                            title="搜索"
                        >
                        <i class="sidebar-button-icon fa fa-search" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">搜索</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="#about"
                            
                            rel="noopener"
                            title="关于"
                        >
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">关于</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/biwin-wangli"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="http://stackoverflow.com/users"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Stack Overflow"
                        >
                        <i class="sidebar-button-icon fab fa-stack-overflow" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Stack Overflow</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://www.linkedin.com/profile/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="LinkedIn"
                        >
                        <i class="sidebar-button-icon fab fa-linkedin" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">LinkedIn</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="mailto:274027703@qq.com"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="邮箱"
                        >
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">邮箱</span>
                    </a>
            </li>
            
        </ul>
        
        <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=110 src="//music.163.com/outchain/player?type=0&id=3132987672&auto=1&height=90"></iframe>
    </div>
</nav>

            
        <div class="post-header-cover
                    text-center
                    post-header-cover--full"
             style="background-image:url('http://pic.tsmp4.net/api/fengjing/img.php');"
             data-behavior="4">
            
                <div class="post-header main-content-wrap text-center">
    
        <h1 class="post-title">
            HashMap为什么线程不安全
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2019-12-16T14:58:20+08:00">
	
		    2019 年 12 月 16 日
    	
    </time>
    
        <span>发布在 </span>
        
    <a class="category-link" href="/categories/java/">java</a>


    
</div>

        
    
    
        <!-- 不蒜子统计 -->
        <span id="busuanzi_container_page_pv" style='display:none' class="post-meta">
	        <i class="icon-smile icon"></i> 阅读数：<span id="busuanzi_value_page_pv"></span>次
	    </span>
    
</div>

            
        </div>

            <div id="main" data-behavior="4"
                 class="hasCover
                        hasCoverMetaIn
                        hasCoverCaption">
                
<article class="post">
    
        <span class="post-header-cover-caption caption">再繁忙的学习，也需要静一会下来，放松自己，欣赏美丽的风景</span>
    
    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <!-- excerpt -->
<h1 id="table-of-contents">目录</h1><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Jdk1-7%E4%B8%AD%E7%9A%84HashMap"><span class="toc-text">Jdk1.7中的HashMap</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E6%89%A9%E5%AE%B9%E9%80%A0%E6%88%90%E6%AD%BB%E5%BE%AA%E7%8E%AF%E5%88%86%E6%9E%90%E8%BF%87%E7%A8%8B"><span class="toc-text">1.1 扩容造成死循环分析过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A9%E5%AE%B9%E9%80%A0%E6%88%90%E6%95%B0%E6%8D%AE%E4%B8%A2%E5%A4%B1%E5%88%86%E6%9E%90%E8%BF%87%E7%A8%8B"><span class="toc-text">扩容造成数据丢失分析过程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Jdk1-8%E4%B8%AD%E7%9A%84HashMap"><span class="toc-text">Jdk1.8中的HashMap</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">总结</span></a></li></ol>

<h2 id="Jdk1-7中的HashMap"><a href="#Jdk1-7中的HashMap" class="headerlink" title="Jdk1.7中的HashMap"></a>Jdk1.7中的HashMap</h2><p>在jdk1.8中对HashMap做了很多优化，这里先分析在jdk1.7中的问题，相信大家都知道在jdk1.7多线程环境下HashMap容易出现死循环，这里我们先用代码来模拟出现死循环的情况：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HashMapTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">HashMapThread</span> <span class="variable">thread0</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMapThread</span>();</span><br><span class="line">        <span class="type">HashMapThread</span> <span class="variable">thread1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMapThread</span>();</span><br><span class="line">        <span class="type">HashMapThread</span> <span class="variable">thread2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMapThread</span>();</span><br><span class="line">        <span class="type">HashMapThread</span> <span class="variable">thread3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMapThread</span>();</span><br><span class="line">        <span class="type">HashMapThread</span> <span class="variable">thread4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMapThread</span>();</span><br><span class="line">        thread0.start();</span><br><span class="line">        thread1.start();</span><br><span class="line">        thread2.start();</span><br><span class="line">        thread3.start();</span><br><span class="line">        thread4.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HashMapThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">AtomicInteger</span> <span class="variable">ai</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;Integer, Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (ai.get() &lt; <span class="number">1000000</span>) &#123;</span><br><span class="line">            map.put(ai.get(), ai.get());</span><br><span class="line">            System.out.println(ai.incrementAndGet());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上述代码比较简单，就是开多个线程不断进行put操作，并且HashMap与AtomicInteger都是全局共享的。<br>在多运行几次该代码后，出现如下死循环情形：<br><img src="https://5b868fd.webp.li/hashmapUnsafe-1.png" alt="image.png"><br>其中有几次还会出现数组越界的情况：<br><img src="https://5b868fd.webp.li/hashmapUnsafe-2.png" alt="image.png"></p>
<p>这里我们着重分析为什么会出现死循环的情况，通过jps和jstack命名查看死循环情况，结果如下：<br><img src="https://5b868fd.webp.li/hashmapUnsafe-3.png" alt="image.png"><br><img src="https://5b868fd.webp.li/hashmapUnsafe-4.png" alt="image.png"></p>
<p>从堆栈信息中可以看到出现死循环的位置，通过该信息可明确知道死循环发生在HashMap的扩容函数中，根源在transfer函数中，jdk1.7中HashMap的transfer函数如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">(Entry[] newTable, <span class="type">boolean</span> rehash)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">newCapacity</span> <span class="operator">=</span> newTable.length;</span><br><span class="line">        <span class="keyword">for</span> (Entry&lt;K,V&gt; e : table) &#123;</span><br><span class="line">            <span class="keyword">while</span>(<span class="literal">null</span> != e) &#123;</span><br><span class="line">                Entry&lt;K,V&gt; next = e.next;</span><br><span class="line">                <span class="keyword">if</span> (rehash) &#123;</span><br><span class="line">                    e.hash = <span class="literal">null</span> == e.key ? <span class="number">0</span> : hash(e.key);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> indexFor(e.hash, newCapacity);</span><br><span class="line">                e.next = newTable[i];</span><br><span class="line">                newTable[i] = e;</span><br><span class="line">                e = next;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>总结下该函数的主要作用：<br>在对table进行扩容到newTable后，需要将原来数据转移到newTable中，注意10-12行代码，这里可以看出在转移元素的过程中，使用的是头插法，也就是链表的顺序会翻转，这里也是形成死循环的关键点。</p>
<p>下面进行详细分析。</p>
<h3 id="1-1-扩容造成死循环分析过程"><a href="#1-1-扩容造成死循环分析过程" class="headerlink" title="1.1 扩容造成死循环分析过程"></a>1.1 扩容造成死循环分析过程</h3><p>前提条件，这里假设：</p>
<ol>
<li>hash算法为简单的用key mod链表的大小。</li>
<li>最开始hash表size&#x3D;2，key&#x3D;3,7,5，则都在table[1]中。</li>
<li>然后进行resize，使size变成4。</li>
</ol>
<p>未resize前的数据结构如下：<br><img src="https://5b868fd.webp.li/hashmapUnsafe-5.png" alt="image.png"></p>
<p>如果在单线程环境下，最后的结果如下：<br><img src="https://5b868fd.webp.li/hashmapUnsafe-6.png" alt="image.png"></p>
<p>这里的转移过程，不再进行详述，只要理解transfer函数在做什么，其转移过程以及如何对链表进行反转应该不难。</p>
<p>然后在多线程环境下，假设有两个线程A和B都在进行put操作。线程A在执行到transfer函数中第11行代码处挂起，因为该函数在这里分析的地位非常重要，因此再次贴出来。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Transfers all entries from current table to newTable.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">(Entry[] newTable, <span class="type">boolean</span> rehash)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">newCapacity</span> <span class="operator">=</span> newTable.length;</span><br><span class="line">    <span class="keyword">for</span> (Entry&lt;K,V&gt; e : table) &#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">null</span> != e) &#123;</span><br><span class="line">            Entry&lt;K,V&gt; next = e.next;</span><br><span class="line">            <span class="keyword">if</span> (rehash) &#123;</span><br><span class="line">                e.hash = <span class="literal">null</span> == e.key ? <span class="number">0</span> : hash(e.key);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> indexFor(e.hash, newCapacity);</span><br><span class="line">            e.next = newTable[i];</span><br><span class="line">            newTable[i] = e; <span class="comment">// 线程A在这里挂起</span></span><br><span class="line">            e = next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时线程A中运行结果如下：<br><img src="https://5b868fd.webp.li/hashmapUnsafe-7.png" alt="image.png"><br>线程A挂起后，此时线程B正常执行，并完成resize操作，结果如下：<br><img src="https://5b868fd.webp.li/hashmapUnsafe-8.png" alt="image.png"></p>
<p>这里需要特别注意的点：由于线程B已经执行完毕，根据Java内存模型，现在newTable和table中的Entry都是主存中最新值：7.next&#x3D;3，3.next&#x3D;null。</p>
<p>此时切换到线程A上，在线程A挂起时内存中值如下：e&#x3D;3，next&#x3D;7，newTable[3]&#x3D;null，代码执行过程如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">newTable[<span class="number">3</span>]=e ----&gt; newTable[<span class="number">3</span>]=<span class="number">3</span></span><br><span class="line">e=next ----&gt; e=<span class="number">7</span></span><br></pre></td></tr></table></figure>

<p>此时结果如下：<br><img src="https://5b868fd.webp.li/hashmapUnsafe-9.png" alt="image.png"><br>继续循环：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">e=<span class="number">7</span></span><br><span class="line">next=e.next ----&gt; next=<span class="number">3</span>【从主存中取值】</span><br><span class="line">e.next=newTable[<span class="number">3</span>] ----&gt; e.next=<span class="number">3</span>【从主存中取值】</span><br><span class="line">newTable[<span class="number">3</span>]=e ----&gt; newTable[<span class="number">3</span>]=<span class="number">7</span></span><br><span class="line">e=next ----&gt; e=<span class="number">3</span></span><br></pre></td></tr></table></figure>
<p><img src="https://5b868fd.webp.li/hashmapUnsafe-10.png" alt="image.png"><br>再次进行循环：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">e=<span class="number">3</span></span><br><span class="line">next=e.next ----&gt; next=<span class="literal">null</span></span><br><span class="line">e.next=newTable[<span class="number">3</span>] ----&gt; e.next=<span class="number">7</span> 即：<span class="number">3.</span>next=<span class="number">7</span></span><br><span class="line">newTable[<span class="number">3</span>]=e ----&gt; newTable[<span class="number">3</span>]=<span class="number">3</span></span><br><span class="line">e=next ----&gt; e=<span class="literal">null</span></span><br></pre></td></tr></table></figure>
<p>注意此次循环：e.next&#x3D;7，而在上次循环中7.next&#x3D;3，出现环形链表，并且此时e&#x3D;null循环结束。<br>结果如下：<br><img src="https://5b868fd.webp.li/hashmapUnsafe-11.png" alt="image.png"><br>在后续操作中只要涉及轮询HashMap的数据结构，就会在这里发生死循环，造成悲剧。面试必问的：{ % post_link 几种线程安全的Map解析 % }，推荐大家看下。</p>
<h3 id="扩容造成数据丢失分析过程"><a href="#扩容造成数据丢失分析过程" class="headerlink" title="扩容造成数据丢失分析过程"></a>扩容造成数据丢失分析过程</h3><p>遵照上述分析过程，初始时：<br><img src="https://5b868fd.webp.li/hashmapUnsafe-12.png" alt="image.png"><br>线程A和线程B进行put操作，同样线程A挂起：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Transfers all entries from current table to newTable.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">(Entry[] newTable, <span class="type">boolean</span> rehash)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">newCapacity</span> <span class="operator">=</span> newTable.length;</span><br><span class="line">    <span class="keyword">for</span> (Entry&lt;K,V&gt; e : table) &#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">null</span> != e) &#123;</span><br><span class="line">            Entry&lt;K,V&gt; next = e.next;</span><br><span class="line">            <span class="keyword">if</span> (rehash) &#123;</span><br><span class="line">                e.hash = <span class="literal">null</span> == e.key ? <span class="number">0</span> : hash(e.key);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> indexFor(e.hash, newCapacity);</span><br><span class="line">            e.next = newTable[i];</span><br><span class="line">            newTable[i] = e; <span class="comment">// 线程A在这里挂起</span></span><br><span class="line">            e = next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此时线程A的运行结果如下：<br><img src="https://5b868fd.webp.li/hashmapUnsafe-13.png" alt="image.png"><br>此时线程B已获得CPU时间片，并完成resize操作：<br><img src="https://5b868fd.webp.li/hashmapUnsafe-14.png" alt="image.png"></p>
<p>同样注意由于线程B执行完成，newTable和table都为最新值：5.next&#x3D;null。<br>此时切换到线程A，在线程A挂起时：e&#x3D;7，next&#x3D;5，newTable[3]&#x3D;null。<br>执行newtable[i]&#x3D;e，就将7放在了table[3]的位置，此时next&#x3D;5。接着进行下一次循环：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">e=<span class="number">5</span></span><br><span class="line">next=e.next ----&gt; next=<span class="literal">null</span>，从主存中取值</span><br><span class="line">e.next=newTable[<span class="number">1</span>] ----&gt; e.next=<span class="number">5</span>，从主存中取值</span><br><span class="line">newTable[<span class="number">1</span>]=e ----&gt; newTable[<span class="number">1</span>]=<span class="number">5</span></span><br><span class="line">e=next ----&gt; e=<span class="literal">null</span></span><br></pre></td></tr></table></figure>
<p>将5放置在table[1]位置，此时e&#x3D;null循环结束，3元素丢失，并形成环形链表。并在后续操作HashMap时造成死循环。<br><img src="https://5b868fd.webp.li/hashmapUnsafe-15.png" alt="image.png"></p>
<h2 id="Jdk1-8中的HashMap"><a href="#Jdk1-8中的HashMap" class="headerlink" title="Jdk1.8中的HashMap"></a>Jdk1.8中的HashMap</h2><p>在jdk1.8中对HashMap进行了优化，在发生hash碰撞，不再采用头插法方式，而是直接插入链表尾部，因此不会出现环形链表的情况，但是在多线程的情况下仍然不安全。</p>
<p>这里我们看jdk1.8中HashMap的put操作源码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> V <span class="title function_">putVal</span><span class="params">(<span class="type">int</span> hash, K key, V value, <span class="type">boolean</span> onlyIfAbsent,</span></span><br><span class="line"><span class="params">                   <span class="type">boolean</span> evict)</span> &#123;</span><br><span class="line">        Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="type">int</span> n, i;</span><br><span class="line">        <span class="keyword">if</span> ((tab = table) == <span class="literal">null</span> || (n = tab.length) == <span class="number">0</span>)</span><br><span class="line">            n = (tab = resize()).length;</span><br><span class="line">        <span class="keyword">if</span> ((p = tab[i = (n - <span class="number">1</span>) &amp; hash]) == <span class="literal">null</span>) <span class="comment">// 如果没有hash碰撞则直接插入元素</span></span><br><span class="line">            tab[i] = newNode(hash, key, value, <span class="literal">null</span>);</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            Node&lt;K,V&gt; e; K k;</span><br><span class="line">            <span class="keyword">if</span> (p.hash == hash &amp;&amp;</span><br><span class="line">                ((k = p.key) == key || (key != <span class="literal">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                e = p;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (p <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(<span class="built_in">this</span>, tab, hash, key, value);</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">binCount</span> <span class="operator">=</span> <span class="number">0</span>; ; ++binCount) &#123;</span><br><span class="line">                    <span class="keyword">if</span> ((e = p.next) == <span class="literal">null</span>) &#123;</span><br><span class="line">                        p.next = newNode(hash, key, value, <span class="literal">null</span>);</span><br><span class="line">                        <span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class="number">1</span>) <span class="comment">// -1 for 1st</span></span><br><span class="line">                            treeifyBin(tab, hash);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                        ((k = e.key) == key || (key != <span class="literal">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    p = e;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (e != <span class="literal">null</span>) &#123; <span class="comment">// existing mapping for key</span></span><br><span class="line">                <span class="type">V</span> <span class="variable">oldValue</span> <span class="operator">=</span> e.value;</span><br><span class="line">                <span class="keyword">if</span> (!onlyIfAbsent || oldValue == <span class="literal">null</span>)</span><br><span class="line">                    e.value = value;</span><br><span class="line">                afterNodeAccess(e);</span><br><span class="line">                <span class="keyword">return</span> oldValue;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ++modCount;</span><br><span class="line">        <span class="keyword">if</span> (++size &gt; threshold)</span><br><span class="line">            resize();</span><br><span class="line">        afterNodeInsertion(evict);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这是jdk1.8中HashMap中put操作的主函数， 注意第6行代码，如果没有hash碰撞则会直接插入元素。</p>
<p>如果线程A和线程B同时进行put操作，刚好这两条不同的数据hash值一样，并且该位置数据为null，所以这线程A、B都会进入第6行代码中。</p>
<p>假设一种情况，线程A进入后还未进行数据插入时挂起，而线程B正常执行，从而正常插入数据，然后线程A获取CPU时间片，此时线程A不用再进行hash判断了，问题出现：线程A会把线程B插入的数据给覆盖，发生线程不安全。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>首先HashMap是线程不安全的，其主要体现：</p>
<ol>
<li>在jdk1.7中，在多线程环境下，扩容时会造成环形链或数据丢失。</li>
<li>在jdk1.8中，在多线程环境下，会发生数据覆盖的情况。</li>
</ol>
            


        </div>
    </div>
    <br/>
    <!-- 添加的部分 -->
    <!-- copyright -->
    
        <style>
.article-footer-copyright {
	border-left-color: #f66;
	padding: 12px 24px 12px 30px;
    margin: 2em 0;
    border-left-width: 4px;
    border-left-style: solid;
    background-color: #f8f8f8;
    position: relative;
    border-bottom-right-radius: 2px;
    border-top-right-radius: 2px;
	margin:0 auto;
	max-width: 850px;}
</style>
<div class="article-footer-copyright">
    <!-- <span>本文标题:</span><href="/%20"> HashMap为什么线程不安全</a><br/> -->
    <!-- <span>文章作者:</span><a href="/" title="访问 Mr.WangLi的个人博客">Mr.WangLi</a><br/> -->
	<span>版权归属:</span><a href="/" title="访问 Mr.WangLi的个人博客">Mr.WangLi</a><br/>
    <span>发布时间:</span>2019年12月16日 - 14:58 | 
    <span>最后更新:</span>2024年09月01日 - 21:22<br/>
    <span>原始链接:</span><a href="/posts/4e3779c6.html" title="HashMap为什么线程不安全">https://blog.biwin.eu.org/posts/4e3779c6.html</a><br/>
    <span class="copy-path" title="点击复制文章链接"><i class="fa fa-clipboard" data-clipboard-text="https://blog.biwin.eu.org/posts/4e3779c6.html"  aria-label="复制成功！"></i></span><br/>
    <span>许可协议:</span><i class="fab fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">知识共享署名4.0 国际许可协议</a> 转载请保留原文链接及作者。
</div>

    
    <!-- copyright -->
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">标签</span><br/>
                
    <a class="tag tag--primary tag--small t-none-link" href="/tags/JDK8/" rel="tag">JDK8</a>

            </div>
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/posts/b829b66a.html"
                    data-tooltip="Zookeeper"
                    aria-label="上一篇: Zookeeper"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">上一篇</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/posts/8d02a8ee.html"
                    data-tooltip="四、(Docker系列)Docker项目实战"
                    aria-label="下一篇: 四、(Docker系列)Docker项目实战"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">下一篇</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Diesen Beitrag teilen"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="http://service.weibo.com/share/share.php?&amp;title=https://blog.biwin.eu.org/posts/4e3779c6.html"
                    title="分享到 Weibo"
                    aria-label="分享到 Weibo"
                >
                    <i class="fab fa-weibo" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.biwin.eu.org/posts/4e3779c6.html&amp;title=HashMap为什么线程不安全"
                    title="分享到 QQ"
                    aria-label="分享到 QQ"
                >
                    <i class="fab fa-qq" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https://blog.biwin.eu.org/posts/4e3779c6.html"
                    title="分享到 Qzone"
                    aria-label="分享到 Qzone"
                >
                    <i class="fa fa-star" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#table-of-contents" aria-label="目录">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
                <br/>
<div class="vcomment"></div>
            
        
    </div>
</article>




                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2024 Mr.WangLi. All Rights Reserved.
    </span>
    <br/>
    
        <!-- 不蒜子统计 -->
        <span id="busuanzi_container_site_pv">
	                本站总访问量<span id="busuanzi_value_site_pv"></span>次
	        </span>
        <span class="post-meta-divider">|</span>
        <span id="busuanzi_container_site_uv" style='display:none'>
	                本站访客数<span id="busuanzi_value_site_uv"></span>人
	        </span>
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/posts/b829b66a.html"
                    data-tooltip="Zookeeper"
                    aria-label="上一篇: Zookeeper"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">上一篇</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/posts/8d02a8ee.html"
                    data-tooltip="四、(Docker系列)Docker项目实战"
                    aria-label="下一篇: 四、(Docker系列)Docker项目实战"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">下一篇</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Diesen Beitrag teilen"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="http://service.weibo.com/share/share.php?&amp;title=https://blog.biwin.eu.org/posts/4e3779c6.html"
                    title="分享到 Weibo"
                    aria-label="分享到 Weibo"
                >
                    <i class="fab fa-weibo" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.biwin.eu.org/posts/4e3779c6.html&amp;title=HashMap为什么线程不安全"
                    title="分享到 QQ"
                    aria-label="分享到 QQ"
                >
                    <i class="fab fa-qq" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https://blog.biwin.eu.org/posts/4e3779c6.html"
                    title="分享到 Qzone"
                    aria-label="分享到 Qzone"
                >
                    <i class="fa fa-star" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#table-of-contents" aria-label="目录">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                
    <div id="share-options-bar" class="share-options-bar" data-behavior="4">
        <i id="btn-close-shareoptions" class="fa fa-times"></i>
        <ul class="share-options">
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="http://service.weibo.com/share/share.php?&amp;title=https://blog.biwin.eu.org/posts/4e3779c6.html"
                        aria-label="分享到 Weibo"
                    >
                        <i class="fab fa-weibo" aria-hidden="true"></i><span>分享到 Weibo</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="http://connect.qq.com/widget/shareqq/index.html?url=https://blog.biwin.eu.org/posts/4e3779c6.html&amp;title=HashMap为什么线程不安全"
                        aria-label="分享到 QQ"
                    >
                        <i class="fab fa-qq" aria-hidden="true"></i><span>分享到 QQ</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https://blog.biwin.eu.org/posts/4e3779c6.html"
                        aria-label="分享到 Qzone"
                    >
                        <i class="fa fa-star" aria-hidden="true"></i><span>分享到 Qzone</span>
                    </a>
                </li>
            
        </ul>
    </div>


            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="https://img.biwin.eu.org/touxiang.jpeg" alt="作者的图片"/>
        
            <h4 id="about-card-name">Mr.WangLi</h4>
        
            <div id="about-card-bio"><p>喜欢技术，喜欢一个人！</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>一个有脾气的 Javaer</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker-alt"></i>
                <br/>
                中国·四川·成都
            </div>
        
    </div>
</div>

        
            <div id="algolia-search-modal" class="modal-container">
    <div class="modal">
        <div class="modal-header">
            <span class="close-button"><i class="fa fa-times"></i></span>
            <a href="https://algolia.com" target="_blank" rel="noopener" class="searchby-algolia text-color-light link-unstyled">
                <span class="searchby-algolia-text text-color-light text-small">by</span>
                <img class="searchby-algolia-logo" src="/assets/images/logo-algolia-nebula-blue-full.svg">
            </a>
            <i class="search-icon fa fa-search"></i>
            <form id="algolia-search-form">
                <input type="text" id="algolia-search-input" name="search"
                    class="form-control input--large search-input" placeholder="Search "
                    />
            </form>
        </div>
        <div class="modal-body">
            <div class="no-result text-color-light text-center">没有找到文章</div>
            <div class="results">
                
                <div class="media">
                    
                    <div class="media-left">
                        <a
                            class="link-unstyled"
                            href="https://blog.biwin.eu.org/posts/e800f027.html"
                            aria-label=": Java8新特性之Lambda表达式"
                        >
                            <img class="media-image" src="https://api.dujin.org/bing/1366.php" width="90" height="90"/>
                        </a>
                    </div>
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://blog.biwin.eu.org/posts/e800f027.html"
                            aria-label=": Java8新特性之Lambda表达式"
                        >
                            <h3 class="media-heading">Java8新特性之Lambda表达式</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2018年6月19日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>lambda表达式是java8给我们带来的几个重量级新特性之一，借用lambda表达式，可以让我们的java程序设计更加简洁。最近新的项目摒弃了1.6的版本，全面基于java8进行开发，本篇文章是java8新特性的第一篇，将探讨行为参数化、lambda表达式，以及方法引用。</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-left">
                        <a
                            class="link-unstyled"
                            href="https://blog.biwin.eu.org/posts/e19f5dc7.html"
                            aria-label=": Java8新特性之Optional类"
                        >
                            <img class="media-image" src="https://api.dujin.org/bing/1366.php" width="90" height="90"/>
                        </a>
                    </div>
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://blog.biwin.eu.org/posts/e19f5dc7.html"
                            aria-label=": Java8新特性之Optional类"
                        >
                            <h3 class="media-heading">Java8新特性之Optional类</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2018年6月19日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>Optional不是对null关键字的一种替代，而是对于null判定提供了一种更加优雅的实现</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-left">
                        <a
                            class="link-unstyled"
                            href="https://blog.biwin.eu.org/posts/df816e2e.html"
                            aria-label=": Java8新特性之流式数据处理"
                        >
                            <img class="media-image" src="https://api.dujin.org/bing/1366.php" width="90" height="90"/>
                        </a>
                    </div>
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://blog.biwin.eu.org/posts/df816e2e.html"
                            aria-label=": Java8新特性之流式数据处理"
                        >
                            <h3 class="media-heading">Java8新特性之流式数据处理</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2018年6月20日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>java8的流式处理极大了简化我们对于集合、数组等结构的操作，让我们可以以函数式的思想去操作，本篇文章将探讨java8的流式数据处理的基本使用。</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-left">
                        <a
                            class="link-unstyled"
                            href="https://blog.biwin.eu.org/posts/4e2dcaec.html"
                            aria-label=": Java8新特性之默认接口方法"
                        >
                            <img class="media-image" src="https://api.dujin.org/bing/1366.php" width="90" height="90"/>
                        </a>
                    </div>
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://blog.biwin.eu.org/posts/4e2dcaec.html"
                            aria-label=": Java8新特性之默认接口方法"
                        >
                            <h3 class="media-heading">Java8新特性之默认接口方法</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2018年6月21日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>从java8开始，接口不只是一个只能声明方法的地方，我们还可以在声明方法时，给方法一个默认的实现，我们称之为默认接口方法，这样所有实现该接口的子类都可以持有该方法的默认实现。</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-left">
                        <a
                            class="link-unstyled"
                            href="https://blog.biwin.eu.org/posts/f5f90d4.html"
                            aria-label=": 一、(Docker系列)初识Docker，搭建本地环境"
                        >
                            <img class="media-image" src="https://5b868fd.webp.li/docker-conver.png" width="90" height="90"/>
                        </a>
                    </div>
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://blog.biwin.eu.org/posts/f5f90d4.html"
                            aria-label=": 一、(Docker系列)初识Docker，搭建本地环境"
                        >
                            <h3 class="media-heading">一、(Docker系列)初识Docker，搭建本地环境</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2019年11月5日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>学习搭建Docker环境，结合{ % post_link docker工具箱命令集-问题集锦 % }食用，效果佳</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-left">
                        <a
                            class="link-unstyled"
                            href="https://blog.biwin.eu.org/posts/1d2e50aa.html"
                            aria-label=": 二、(Docker系列)Docker灵魂探讨"
                        >
                            <img class="media-image" src="https://5b868fd.webp.li/docker-conver.png" width="90" height="90"/>
                        </a>
                    </div>
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://blog.biwin.eu.org/posts/1d2e50aa.html"
                            aria-label=": 二、(Docker系列)Docker灵魂探讨"
                        >
                            <h3 class="media-heading">二、(Docker系列)Docker灵魂探讨</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2019年11月6日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>深入学习Image和Container</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-left">
                        <a
                            class="link-unstyled"
                            href="https://blog.biwin.eu.org/posts/a2fc68e9.html"
                            aria-label=": 三、(Docker系列)Docker精髓剖析-网络"
                        >
                            <img class="media-image" src="https://5b868fd.webp.li/docker-conver.png" width="90" height="90"/>
                        </a>
                    </div>
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://blog.biwin.eu.org/posts/a2fc68e9.html"
                            aria-label=": 三、(Docker系列)Docker精髓剖析-网络"
                        >
                            <h3 class="media-heading">三、(Docker系列)Docker精髓剖析-网络</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2019年11月15日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>Docker和Linux中的网络深入</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-left">
                        <a
                            class="link-unstyled"
                            href="https://blog.biwin.eu.org/posts/525c4592.html"
                            aria-label=": 五、(Docker系列)Docker深度提升篇笔记"
                        >
                            <img class="media-image" src="https://5b868fd.webp.li/docker-conver.png" width="90" height="90"/>
                        </a>
                    </div>
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://blog.biwin.eu.org/posts/525c4592.html"
                            aria-label=": 五、(Docker系列)Docker深度提升篇笔记"
                        >
                            <h3 class="media-heading">五、(Docker系列)Docker深度提升篇笔记</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2019年11月23日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>Docker Compose与Docker Swarm</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-left">
                        <a
                            class="link-unstyled"
                            href="https://blog.biwin.eu.org/posts/a95bfc2e.html"
                            aria-label=": docker工具箱命令集-问题集锦"
                        >
                            <img class="media-image" src="https://5b868fd.webp.li/docker-conver.png" width="90" height="90"/>
                        </a>
                    </div>
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://blog.biwin.eu.org/posts/a95bfc2e.html"
                            aria-label=": docker工具箱命令集-问题集锦"
                        >
                            <h3 class="media-heading">docker工具箱命令集-问题集锦</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2019年11月23日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>Vagrant Docker 命令集解释备忘</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-left">
                        <a
                            class="link-unstyled"
                            href="https://blog.biwin.eu.org/posts/8d02a8ee.html"
                            aria-label=": 四、(Docker系列)Docker项目实战"
                        >
                            <img class="media-image" src="https://5b868fd.webp.li/docker-conver.png" width="90" height="90"/>
                        </a>
                    </div>
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="https://blog.biwin.eu.org/posts/8d02a8ee.html"
                            aria-label=": 四、(Docker系列)Docker项目实战"
                        >
                            <h3 class="media-heading">四、(Docker系列)Docker项目实战</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2019年12月13日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>Docker中的Volume</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
            </div>
        </div>
        <div class="modal-footer">
            <p class="results-count text-medium"
                data-message-zero="没有找到文章"
                data-message-one="找到 1 篇文章"
                data-message-other="找到 {n} 篇文章">
                找到 18 篇文章
            </p>
        </div>
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/script-2ilv1quqkw94scdhy4pnuktwociarglt6w05ucfykbnexqz9mfxy2dvfhgcl.min.js"></script>

<!--SCRIPTS END-->


    
        
<script src="https://cdn.jsdelivr.net/npm/valine@1.3.10/dist/Valine.min.js"></script>

        <script>
            new Valine({
                el: '.vcomment',
                notify: false,
                verify: false,
                appId: "6Im09hBEDOiBEU45f3fOc9Hm-gzGzoHsz",
                appKey: "Tc4aa3tRDVWw4GJEcBNfaAuB",
                placeholder: "发现问题，讨论问题，反馈问题，欢迎您的留言和评论！",
                pageSize:'10',
                avatar:'monsterid',
                meta: ['nick', 'mail'],
                lang:''
            })
        </script>
    



    
<script src="/assets/js/moment-with-locales.js"></script>

    
<script src="/assets/js/algoliasearch.js"></script>

    <script>
        var algoliaClient = algoliasearch('I16OUI732Q', 'e1b3e94dd16c5fd972a4f855178f99f8');
        var algoliaIndex = algoliaClient.initIndex('blog');
    </script>


    </body>
</html>
